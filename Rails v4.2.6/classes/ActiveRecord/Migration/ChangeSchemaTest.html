<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActiveRecord::Migration::ChangeSchemaTest</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            ActiveRecord::Migration::ChangeSchemaTest 
            
                <span class="parent">&lt; 
                    
                    ActiveRecord::TestCase
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/activerecord/test/cases/migration/change_schema_test_rb.html">activerecord/test/cases/migration/change_schema_test.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-change">change</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-setup">setup</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-test_add_column_not_null_with_default">test_add_column_not_null_with_default</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_add_column_not_null_without_default">test_add_column_not_null_without_default</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_add_column_with_array">test_add_column_with_array</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_add_column_with_primary_key_attribute">test_add_column_with_primary_key_attribute</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_add_column_with_timestamp_type">test_add_column_with_timestamp_type</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_change_column_null">test_change_column_null</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_change_column_quotes_column_names">test_change_column_quotes_column_names</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_column_exists">test_column_exists</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_column_exists_on_table_with_no_options_parameter_supplied">test_column_exists_on_table_with_no_options_parameter_supplied</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_column_exists_with_definition">test_column_exists_with_definition</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_column_exists_with_type">test_column_exists_with_type</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_adds_id">test_create_table_adds_id</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_raises_when_redefining_custom_primary_key_column">test_create_table_raises_when_redefining_custom_primary_key_column</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_raises_when_redefining_primary_key_column">test_create_table_raises_when_redefining_primary_key_column</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_with_array_column">test_create_table_with_array_column</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_with_bigint">test_create_table_with_bigint</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_with_defaults">test_create_table_with_defaults</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_with_limits">test_create_table_with_limits</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_with_not_null_column">test_create_table_with_not_null_column</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_with_primary_key_prefix_as_table_name">test_create_table_with_primary_key_prefix_as_table_name</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_with_primary_key_prefix_as_table_name_with_underscore">test_create_table_with_primary_key_prefix_as_table_name_with_underscore</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_with_timestamps_should_create_datetime_columns">test_create_table_with_timestamps_should_create_datetime_columns</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_with_timestamps_should_create_datetime_columns_with_options">test_create_table_with_timestamps_should_create_datetime_columns_with_options</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_without_a_block">test_create_table_without_a_block</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_table_without_id">test_create_table_without_id</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_keeping_default_and_notnull_constraints_on_change">test_keeping_default_and_notnull_constraints_on_change</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    
      <!-- Section attributes -->
      <div class="sectiontitle">Attributes</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>connection</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [R]
            </td>
            <td class='attr-name'>table_name</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
        
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-change">
            
              <b>change</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-change" name="method-i-change" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-change_source')" id="l_method-i-change_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L346" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-change_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 346</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">change</span>
  <span class="ruby-identifier">change_column_null</span> <span class="ruby-value">:testings</span>, <span class="ruby-value">:foo</span>, <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-setup">
            
              <b>setup</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-setup" name="method-i-setup" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-setup_source')" id="l_method-i-setup_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L8" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-setup_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 8</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">setup</span>
  <span class="ruby-keyword">super</span>
  <span class="ruby-ivar">@connection</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>
  <span class="ruby-ivar">@table_name</span> = <span class="ruby-value">:testings</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_add_column_not_null_with_default">
            
              <b>test_add_column_not_null_with_default</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_add_column_not_null_with_default" name="method-i-test_add_column_not_null_with_default" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_add_column_not_null_with_default_source')" id="l_method-i-test_add_column_not_null_with_default_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L245" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_add_column_not_null_with_default_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 245</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_add_column_not_null_with_default</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">con</span> = <span class="ruby-identifier">connection</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (#{con.quote_column_name(&#39;id&#39;)}, #{con.quote_column_name(&#39;foo&#39;)}) values (1, &#39;hello&#39;)&quot;</span>
  <span class="ruby-identifier">assert_nothing_raised</span> {<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value">:testings</span>, <span class="ruby-value">:bar</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;default&quot;</span> }

  <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (#{con.quote_column_name(&#39;id&#39;)}, #{con.quote_column_name(&#39;foo&#39;)}, #{con.quote_column_name(&#39;bar&#39;)}) values (2, &#39;hello&#39;, NULL)&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_add_column_not_null_without_default">
            
              <b>test_add_column_not_null_without_default</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_add_column_not_null_without_default" name="method-i-test_add_column_not_null_without_default" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_add_column_not_null_without_default_source')" id="l_method-i-test_add_column_not_null_without_default_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L233" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_add_column_not_null_without_default_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 233</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_add_column_not_null_without_default</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value">:testings</span>, <span class="ruby-value">:bar</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-string">&quot;insert into testings (foo, bar) values (&#39;hello&#39;, NULL)&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_add_column_with_array">
            
              <b>test_add_column_with_array</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_add_column_with_array" name="method-i-test_add_column_with_array" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_add_column_with_array_source')" id="l_method-i-test_add_column_with_array_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L78" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_add_column_with_array_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_add_column_with_array</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value">:testings</span>, <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">columns</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>)
  <span class="ruby-identifier">array_column</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;foo&quot;</span> }

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">array_column</span>.<span class="ruby-identifier">array</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_add_column_with_primary_key_attribute">
            
              <b>test_add_column_with_primary_key_attribute</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_add_column_with_primary_key_attribute" name="method-i-test_add_column_with_primary_key_attribute" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_add_column_with_primary_key_attribute_source')" id="l_method-i-test_add_column_with_primary_key_attribute_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L26" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_add_column_with_primary_key_attribute_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 26</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_add_column_with_primary_key_attribute</span>
  <span class="ruby-identifier">testing_table_with_only_foo_attribute</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value">:testings</span>, <span class="ruby-value">:id</span>, <span class="ruby-value">:primary_key</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>).<span class="ruby-identifier">size</span>, <span class="ruby-number">2</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_add_column_with_timestamp_type">
            
              <b>test_add_column_with_timestamp_type</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_add_column_with_timestamp_type" name="method-i-test_add_column_with_timestamp_type" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_add_column_with_timestamp_type_source')" id="l_method-i-test_add_column_with_timestamp_type_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L259" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_add_column_with_timestamp_type_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_add_column_with_timestamp_type</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:timestamp</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">klass</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>)
  <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">table_name</span> = <span class="ruby-string">&#39;testings&#39;</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">:datetime</span>, <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&#39;foo&#39;</span>].<span class="ruby-identifier">type</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-value">:PostgreSQLAdapter</span>)
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;timestamp without time zone&#39;</span>, <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&#39;foo&#39;</span>].<span class="ruby-identifier">sql_type</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">type_to_sql</span>(<span class="ruby-string">&#39;datetime&#39;</span>), <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&#39;foo&#39;</span>].<span class="ruby-identifier">sql_type</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_change_column_null">
            
              <b>test_change_column_null</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_change_column_null" name="method-i-test_change_column_null" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_change_column_null_source')" id="l_method-i-test_change_column_null_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L343" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_change_column_null_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 343</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_change_column_null</span>
  <span class="ruby-identifier">testing_table_with_only_foo_attribute</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">notnull_migration</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">change</span>
        <span class="ruby-identifier">change_column_null</span> <span class="ruby-value">:testings</span>, <span class="ruby-value">:foo</span>, <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">notnull_migration</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">suppress_messages</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">notnull_migration</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-value">:up</span>)
      <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>).<span class="ruby-identifier">find</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;foo&quot;</span>}.<span class="ruby-identifier">null</span>
      <span class="ruby-identifier">notnull_migration</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-value">:down</span>)
      <span class="ruby-identifier">assert</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>).<span class="ruby-identifier">find</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;foo&quot;</span>}.<span class="ruby-identifier">null</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_change_column_quotes_column_names">
            
              <b>test_change_column_quotes_column_names</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_change_column_quotes_column_names" name="method-i-test_change_column_quotes_column_names" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_change_column_quotes_column_names_source')" id="l_method-i-test_change_column_quotes_column_names_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L276" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_change_column_quotes_column_names_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 276</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_change_column_quotes_column_names</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:select</span>, <span class="ruby-value">:string</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value">:testings</span>, <span class="ruby-value">:select</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">10</span>

  <span class="ruby-comment"># Oracle needs primary key value from sequence</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-value">:OracleAdapter</span>)
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (id, #{connection.quote_column_name(&#39;select&#39;)}) values (testings_seq.nextval, &#39;7 chars&#39;)&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (#{connection.quote_column_name(&#39;select&#39;)}) values (&#39;7 chars&#39;)&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_column_exists">
            
              <b>test_column_exists</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_column_exists" name="method-i-test_column_exists" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_column_exists_source')" id="l_method-i-test_column_exists_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L359" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_column_exists_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 359</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_column_exists</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:foo</span>)
  <span class="ruby-identifier">assert_not</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:bar</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_column_exists_on_table_with_no_options_parameter_supplied">
            
              <b>test_column_exists_on_table_with_no_options_parameter_supplied</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_column_exists_on_table_with_no_options_parameter_supplied" name="method-i-test_column_exists_on_table_with_no_options_parameter_supplied" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_column_exists_on_table_with_no_options_parameter_supplied_source')" id="l_method-i-test_column_exists_on_table_with_no_options_parameter_supplied_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L399" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_column_exists_on_table_with_no_options_parameter_supplied_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 399</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_column_exists_on_table_with_no_options_parameter_supplied</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">string</span> <span class="ruby-value">:foo</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:foo</span>)
    <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">t</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:bar</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_column_exists_with_definition">
            
              <b>test_column_exists_with_definition</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_column_exists_with_definition" name="method-i-test_column_exists_with_definition" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_column_exists_with_definition_source')" id="l_method-i-test_column_exists_with_definition_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L381" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_column_exists_with_definition_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 381</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_column_exists_with_definition</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>, <span class="ruby-identifier">limit</span><span class="ruby-operator">:</span> <span class="ruby-number">100</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:bar</span>, <span class="ruby-value">:decimal</span>, <span class="ruby-identifier">precision</span><span class="ruby-operator">:</span> <span class="ruby-number">8</span>, <span class="ruby-identifier">scale</span><span class="ruby-operator">:</span> <span class="ruby-number">2</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:taggable_id</span>, <span class="ruby-value">:integer</span>, <span class="ruby-identifier">null</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:taggable_type</span>, <span class="ruby-value">:string</span>, <span class="ruby-identifier">default</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Photo&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>, <span class="ruby-identifier">limit</span><span class="ruby-operator">:</span> <span class="ruby-number">100</span>)
  <span class="ruby-identifier">assert_not</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>, <span class="ruby-identifier">limit</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:bar</span>, <span class="ruby-value">:decimal</span>, <span class="ruby-identifier">precision</span><span class="ruby-operator">:</span> <span class="ruby-number">8</span>, <span class="ruby-identifier">scale</span><span class="ruby-operator">:</span> <span class="ruby-number">2</span>)
  <span class="ruby-identifier">assert_not</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:bar</span>, <span class="ruby-value">:decimal</span>, <span class="ruby-identifier">precision</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">scale</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:taggable_id</span>, <span class="ruby-value">:integer</span>, <span class="ruby-identifier">null</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">assert_not</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:taggable_id</span>, <span class="ruby-value">:integer</span>, <span class="ruby-identifier">null</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:taggable_type</span>, <span class="ruby-value">:string</span>, <span class="ruby-identifier">default</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Photo&#39;</span>)
  <span class="ruby-identifier">assert_not</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:taggable_type</span>, <span class="ruby-value">:string</span>, <span class="ruby-identifier">default</span><span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_column_exists_with_type">
            
              <b>test_column_exists_with_type</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_column_exists_with_type" name="method-i-test_column_exists_with_type" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_column_exists_with_type_source')" id="l_method-i-test_column_exists_with_type_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L368" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_column_exists_with_type_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 368</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_column_exists_with_type</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:bar</span>, <span class="ruby-value">:decimal</span>, <span class="ruby-value">:precision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">8</span>, <span class="ruby-value">:scale</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">2</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>)
  <span class="ruby-identifier">assert_not</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:foo</span>, <span class="ruby-value">:integer</span>)

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:bar</span>, <span class="ruby-value">:decimal</span>)
  <span class="ruby-identifier">assert_not</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">column_exists?</span>(<span class="ruby-value">:testings</span>, <span class="ruby-value">:bar</span>, <span class="ruby-value">:integer</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_adds_id">
            
              <b>test_create_table_adds_id</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_adds_id" name="method-i-test_create_table_adds_id" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_adds_id_source')" id="l_method-i-test_create_table_adds_id_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L33" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_adds_id_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 33</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_adds_id</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(id foo)</span>, <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_raises_when_redefining_custom_primary_key_column">
            
              <b>test_create_table_raises_when_redefining_custom_primary_key_column</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_raises_when_redefining_custom_primary_key_column" name="method-i-test_create_table_raises_when_redefining_custom_primary_key_column" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_raises_when_redefining_custom_primary_key_column_source')" id="l_method-i-test_create_table_raises_when_redefining_custom_primary_key_column_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L187" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_raises_when_redefining_custom_primary_key_column_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_raises_when_redefining_custom_primary_key_column</span>
  <span class="ruby-identifier">error</span> = <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ArgumentError</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span>, <span class="ruby-identifier">primary_key</span><span class="ruby-operator">:</span> <span class="ruby-value">:testing_id</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:testing_id</span>, <span class="ruby-value">:string</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;you can&#39;t redefine the primary key column &#39;testing_id&#39;. To define a custom primary key, pass { id: false } to create_table.&quot;</span>, <span class="ruby-identifier">error</span>.<span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_raises_when_redefining_primary_key_column">
            
              <b>test_create_table_raises_when_redefining_primary_key_column</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_raises_when_redefining_primary_key_column" name="method-i-test_create_table_raises_when_redefining_primary_key_column" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_raises_when_redefining_primary_key_column_source')" id="l_method-i-test_create_table_raises_when_redefining_primary_key_column_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L177" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_raises_when_redefining_primary_key_column_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_raises_when_redefining_primary_key_column</span>
  <span class="ruby-identifier">error</span> = <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ArgumentError</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:id</span>, <span class="ruby-value">:string</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;you can&#39;t redefine the primary key column &#39;id&#39;. To define a custom primary key, pass { id: false } to create_table.&quot;</span>, <span class="ruby-identifier">error</span>.<span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_with_array_column">
            
              <b>test_create_table_with_array_column</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_with_array_column" name="method-i-test_create_table_with_array_column" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_with_array_column_source')" id="l_method-i-test_create_table_with_array_column_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L88" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_with_array_column_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 88</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_with_array_column</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">string</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">columns</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>)
  <span class="ruby-identifier">array_column</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;foo&quot;</span> }

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">array_column</span>.<span class="ruby-identifier">array</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_with_bigint">
            
              <b>test_create_table_with_bigint</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_with_bigint" name="method-i-test_create_table_with_bigint" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_with_bigint_source')" id="l_method-i-test_create_table_with_bigint_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L100" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_with_bigint_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 100</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_with_bigint</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">bigint</span> <span class="ruby-value">:eight_int</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">columns</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>)
  <span class="ruby-identifier">eight</span>   = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;eight_int&quot;</span>   }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-value">:OracleAdapter</span>)
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;NUMBER(19)&#39;</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-value">:SQLite3Adapter</span>)
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;bigint&#39;</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">:integer</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">type</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">8</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">limit</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-value">:testings</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_with_defaults">
            
              <b>test_create_table_with_defaults</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_with_defaults" name="method-i-test_create_table_with_defaults" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_with_defaults_source')" id="l_method-i-test_create_table_with_defaults_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L51" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_with_defaults_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_with_defaults</span>
  <span class="ruby-comment"># MySQL doesn&#39;t allow defaults on TEXT or BLOB columns.</span>
  <span class="ruby-identifier">mysql</span> = <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-value">:MysqlAdapter</span>, <span class="ruby-value">:Mysql2Adapter</span>)

  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:one</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;hello&quot;</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:two</span>, <span class="ruby-value">:boolean</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:three</span>, <span class="ruby-value">:boolean</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:four</span>, <span class="ruby-value">:integer</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">1</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:five</span>, <span class="ruby-value">:text</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;hello&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">mysql</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">columns</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>)
  <span class="ruby-identifier">one</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;one&quot;</span> }
  <span class="ruby-identifier">two</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;two&quot;</span> }
  <span class="ruby-identifier">three</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;three&quot;</span> }
  <span class="ruby-identifier">four</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;four&quot;</span> }
  <span class="ruby-identifier">five</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;five&quot;</span> } <span class="ruby-keyword">unless</span> <span class="ruby-identifier">mysql</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;hello&quot;</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">default</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">two</span>.<span class="ruby-identifier">type_cast_from_database</span>(<span class="ruby-identifier">two</span>.<span class="ruby-identifier">default</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">three</span>.<span class="ruby-identifier">type_cast_from_database</span>(<span class="ruby-identifier">three</span>.<span class="ruby-identifier">default</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;1&#39;</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">default</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;hello&quot;</span>, <span class="ruby-identifier">five</span>.<span class="ruby-identifier">default</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">mysql</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_with_limits">
            
              <b>test_create_table_with_limits</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_with_limits" name="method-i-test_create_table_with_limits" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_with_limits_source')" id="l_method-i-test_create_table_with_limits_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L119" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_with_limits_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_with_limits</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">255</span>

    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:default_int</span>, <span class="ruby-value">:integer</span>

    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:one_int</span>,    <span class="ruby-value">:integer</span>, <span class="ruby-value">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">1</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:four_int</span>,   <span class="ruby-value">:integer</span>, <span class="ruby-value">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">4</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:eight_int</span>,  <span class="ruby-value">:integer</span>, <span class="ruby-value">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">8</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">columns</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>)
  <span class="ruby-identifier">foo</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;foo&quot;</span> }
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">255</span>, <span class="ruby-identifier">foo</span>.<span class="ruby-identifier">limit</span>

  <span class="ruby-identifier">default</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;default_int&quot;</span> }
  <span class="ruby-identifier">one</span>     = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;one_int&quot;</span>     }
  <span class="ruby-identifier">four</span>    = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;four_int&quot;</span>    }
  <span class="ruby-identifier">eight</span>   = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;eight_int&quot;</span>   }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-value">:PostgreSQLAdapter</span>)
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;integer&#39;</span>, <span class="ruby-identifier">default</span>.<span class="ruby-identifier">sql_type</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;smallint&#39;</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">sql_type</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;integer&#39;</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">sql_type</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;bigint&#39;</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-value">:MysqlAdapter</span>, <span class="ruby-value">:Mysql2Adapter</span>)
    <span class="ruby-identifier">assert_match</span> <span class="ruby-string">&#39;int(11)&#39;</span>, <span class="ruby-identifier">default</span>.<span class="ruby-identifier">sql_type</span>
    <span class="ruby-identifier">assert_match</span> <span class="ruby-string">&#39;tinyint&#39;</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">sql_type</span>
    <span class="ruby-identifier">assert_match</span> <span class="ruby-string">&#39;int&#39;</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">sql_type</span>
    <span class="ruby-identifier">assert_match</span> <span class="ruby-string">&#39;bigint&#39;</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-value">:OracleAdapter</span>)
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;NUMBER(38)&#39;</span>, <span class="ruby-identifier">default</span>.<span class="ruby-identifier">sql_type</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;NUMBER(1)&#39;</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">sql_type</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;NUMBER(4)&#39;</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">sql_type</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;NUMBER(8)&#39;</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_with_not_null_column">
            
              <b>test_create_table_with_not_null_column</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_with_not_null_column" name="method-i-test_create_table_with_not_null_column" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_with_not_null_column_source')" id="l_method-i-test_create_table_with_not_null_column_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L41" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_with_not_null_column_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_with_not_null_column</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>, <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-string">&quot;insert into testings (foo) values (NULL)&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_with_primary_key_prefix_as_table_name">
            
              <b>test_create_table_with_primary_key_prefix_as_table_name</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_with_primary_key_prefix_as_table_name" name="method-i-test_create_table_with_primary_key_prefix_as_table_name" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_with_primary_key_prefix_as_table_name_source')" id="l_method-i-test_create_table_with_primary_key_prefix_as_table_name_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L167" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_with_primary_key_prefix_as_table_name_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_with_primary_key_prefix_as_table_name</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-value">:table_name</span>

  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(testingid foo)</span>, <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_with_primary_key_prefix_as_table_name_with_underscore">
            
              <b>test_create_table_with_primary_key_prefix_as_table_name_with_underscore</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_with_primary_key_prefix_as_table_name_with_underscore" name="method-i-test_create_table_with_primary_key_prefix_as_table_name_with_underscore" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_with_primary_key_prefix_as_table_name_with_underscore_source')" id="l_method-i-test_create_table_with_primary_key_prefix_as_table_name_with_underscore_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L157" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_with_primary_key_prefix_as_table_name_with_underscore_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 157</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_with_primary_key_prefix_as_table_name_with_underscore</span>
  <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-value">:table_name_with_underscore</span>

  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">:string</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(testing_id foo)</span>, <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:name</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_with_timestamps_should_create_datetime_columns">
            
              <b>test_create_table_with_timestamps_should_create_datetime_columns</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_with_timestamps_should_create_datetime_columns" name="method-i-test_create_table_with_timestamps_should_create_datetime_columns" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_with_timestamps_should_create_datetime_columns_source')" id="l_method-i-test_create_table_with_timestamps_should_create_datetime_columns_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L197" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_with_timestamps_should_create_datetime_columns_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_with_timestamps_should_create_datetime_columns</span>
  <span class="ruby-comment"># FIXME: Remove the silence when we change the default `null` behavior</span>
  <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Deprecation</span>.<span class="ruby-identifier">silence</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">timestamps</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">created_columns</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">table_name</span>)

  <span class="ruby-identifier">created_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;created_at&#39;</span> }
  <span class="ruby-identifier">updated_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;updated_at&#39;</span> }

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">created_at_column</span>.<span class="ruby-identifier">null</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">updated_at_column</span>.<span class="ruby-identifier">null</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_with_timestamps_should_create_datetime_columns_with_options">
            
              <b>test_create_table_with_timestamps_should_create_datetime_columns_with_options</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_with_timestamps_should_create_datetime_columns_with_options" name="method-i-test_create_table_with_timestamps_should_create_datetime_columns_with_options" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_with_timestamps_should_create_datetime_columns_with_options_source')" id="l_method-i-test_create_table_with_timestamps_should_create_datetime_columns_with_options_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L213" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_with_timestamps_should_create_datetime_columns_with_options_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_with_timestamps_should_create_datetime_columns_with_options</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">timestamps</span> <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">created_columns</span> = <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">table_name</span>)

  <span class="ruby-identifier">created_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;created_at&#39;</span> }
  <span class="ruby-identifier">updated_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;updated_at&#39;</span> }

  <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">created_at_column</span>.<span class="ruby-identifier">null</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">updated_at_column</span>.<span class="ruby-identifier">null</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_without_a_block">
            
              <b>test_create_table_without_a_block</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_without_a_block" name="method-i-test_create_table_without_a_block" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_without_a_block_source')" id="l_method-i-test_create_table_without_a_block_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L226" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_without_a_block_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 226</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_without_a_block</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">table_name</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_table_without_id">
            
              <b>test_create_table_without_id</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_create_table_without_id" name="method-i-test_create_table_without_id" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_table_without_id_source')" id="l_method-i-test_create_table_without_id_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L20" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_create_table_without_id_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_table_without_id</span>
  <span class="ruby-identifier">testing_table_with_only_foo_attribute</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value">:testings</span>).<span class="ruby-identifier">size</span>, <span class="ruby-number">1</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_keeping_default_and_notnull_constraints_on_change">
            
              <b>test_keeping_default_and_notnull_constraints_on_change</b>()
            
            <a href="../../../classes/ActiveRecord/Migration/ChangeSchemaTest.html#method-i-test_keeping_default_and_notnull_constraints_on_change" name="method-i-test_keeping_default_and_notnull_constraints_on_change" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_keeping_default_and_notnull_constraints_on_change_source')" id="l_method-i-test_keeping_default_and_notnull_constraints_on_change_source">show</a>
                
                  | <a href="https://github.com/rails/rails/blob/e957b1a0e82b345e9fc83c15b645514ef5edc2f0/activerecord/test/cases/migration/change_schema_test.rb#L291" target="_blank" class="github_url">on GitHub</a>
                
              </p>
              <div id="method-i-test_keeping_default_and_notnull_constraints_on_change_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/migration/change_schema_test.rb, line 291</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_keeping_default_and_notnull_constraints_on_change</span>
  <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-value">:testings</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value">:title</span>, <span class="ruby-value">:string</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">person_klass</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>)
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">table_name</span> = <span class="ruby-string">&#39;testings&#39;</span>

  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-string">&quot;testings&quot;</span>, <span class="ruby-string">&quot;wealth&quot;</span>, <span class="ruby-value">:integer</span>, <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">99</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">99</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">column_defaults</span>[<span class="ruby-string">&quot;wealth&quot;</span>]
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&quot;wealth&quot;</span>].<span class="ruby-identifier">null</span>
  <span class="ruby-comment"># Oracle needs primary key value from sequence</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-value">:OracleAdapter</span>)
    <span class="ruby-identifier">assert_nothing_raised</span> {<span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-string">&quot;insert into testings (id, title) values (testings_seq.nextval, &#39;tester&#39;)&quot;</span>)}
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">assert_nothing_raised</span> {<span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-string">&quot;insert into testings (title) values (&#39;tester&#39;)&quot;</span>)}
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># change column default to see that column doesn&#39;t lose its not null definition</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_default</span> <span class="ruby-string">&quot;testings&quot;</span>, <span class="ruby-string">&quot;wealth&quot;</span>, <span class="ruby-number">100</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">100</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">column_defaults</span>[<span class="ruby-string">&quot;wealth&quot;</span>]
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&quot;wealth&quot;</span>].<span class="ruby-identifier">null</span>

  <span class="ruby-comment"># rename column to see that column doesn&#39;t lose its not null and/or default definition</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-string">&quot;testings&quot;</span>, <span class="ruby-string">&quot;wealth&quot;</span>, <span class="ruby-string">&quot;money&quot;</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
  <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&quot;wealth&quot;</span>]
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">100</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">column_defaults</span>[<span class="ruby-string">&quot;money&quot;</span>]
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>

  <span class="ruby-comment"># change column</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-string">&quot;testings&quot;</span>, <span class="ruby-string">&quot;money&quot;</span>, <span class="ruby-value">:integer</span>, <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">1000</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">1000</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">column_defaults</span>[<span class="ruby-string">&quot;money&quot;</span>]
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>

  <span class="ruby-comment"># change column, make it nullable and clear default</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-string">&quot;testings&quot;</span>, <span class="ruby-string">&quot;money&quot;</span>, <span class="ruby-value">:integer</span>, <span class="ruby-value">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
  <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>

  <span class="ruby-comment"># change_column_null, make it not nullable and set null values to a default value</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-string">&#39;UPDATE testings SET money = NULL&#39;</span>)
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_null</span> <span class="ruby-string">&quot;testings&quot;</span>, <span class="ruby-string">&quot;money&quot;</span>, <span class="ruby-keyword">false</span>, <span class="ruby-number">2000</span>
  <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
  <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-string">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">2000</span>, <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-string">&quot;SELECT money FROM testings&quot;</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">to_i</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    