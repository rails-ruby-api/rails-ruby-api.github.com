<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OpenSSL::SSL::SSLContext</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../css/github.css" type="text/css" media="screen" />
<script src="../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            OpenSSL::SSL::SSLContext 
            
                <span class="parent">&lt; 
                    
                    <a href="../../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../../files/Users/fschumac/_rvm/src/ruby-1_9_3-p0/ext/openssl/lib/openssl/ssl-internal_rb.html">/Users/fschumac/.rvm/src/ruby-1.9.3-p0/ext/openssl/lib/openssl/ssl-internal.rb</a></li>
            
            <li><a href="../../../files/Users/fschumac/_rvm/src/ruby-1_9_3-p0/ext/openssl/ossl_ssl_c.html">/Users/fschumac/.rvm/src/ruby-1.9.3-p0/ext/openssl/ossl_ssl.c</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>An <a href="SSLContext.html">SSLContext</a> is used to set various options
regarding certificates, algorithms, verification, session caching, etc. 
The <a href="SSLContext.html">SSLContext</a> is used to create an <a
href="SSLSocket.html">SSLSocket</a>.</p>

<p>All attributes must be set before creating an <a
href="SSLSocket.html">SSLSocket</a> as the <a
href="SSLContext.html">SSLContext</a> will be frozen afterward.</p>

<p>The following attributes are available but donâ€™t show up in rdoc:</p>
<ul><li>
<p>ssl_version, cert, key, <a
href="SSLContext.html#attribute-i-client_ca">#client_ca</a>, <a
href="SSLContext.html#attribute-i-ca_file">#ca_file</a>, <a
href="SSLContext.html#attribute-i-ca_path">#ca_path</a>, timeout,</p>
</li><li>
<p><a href="SSLContext.html#attribute-i-verify_mode">#verify_mode</a>, <a
href="SSLContext.html#attribute-i-verify_depth">#verify_depth</a> <a
href="SSLContext.html#attribute-i-client_cert_cb">#client_cert_cb</a>, <a
href="SSLContext.html#attribute-i-tmp_dh_callback">#tmp_dh_callback</a>,</p>
</li><li>
<p><a
href="SSLContext.html#attribute-i-session_id_context">#session_id_context</a>,
session_add_cb, <a
href="SSLContext.html#attribute-i-session_new_cb">#session_new_cb</a>, <a
href="SSLContext.html#attribute-i-session_remove_cb">#session_remove_cb</a></p>
</li></ul>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-ciphers">ciphers</a>,
              </li>
            
              
              <li>
                <a href="#method-i-ciphers-3D">ciphers=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-flush_sessions">flush_sessions</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-session_add">session_add</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_mode">session_cache_mode</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_mode-3D">session_cache_mode=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_size">session_cache_size</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_size-3D">session_cache_size=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_cache_stats">session_cache_stats</a>,
              </li>
            
              
              <li>
                <a href="#method-i-session_remove">session_remove</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_params">set_params</a>,
              </li>
            
              
              <li>
                <a href="#method-i-setup">setup</a>,
              </li>
            
              
              <li>
                <a href="#method-i-ssl_version-3D">ssl_version=</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_PARAMS</td>
            <td>=</td>
            <td class="attr-value">{
:ssl_version =&gt; &quot;SSLv23&quot;,
:verify_mode =&gt; OpenSSL::SSL::VERIFY_PEER,
:ciphers =&gt; &quot;ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW&quot;,
:options =&gt; OpenSSL::SSL::OP_ALL,
}</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">DEFAULT_CERT_STORE</td>
            <td>=</td>
            <td class="attr-value">OpenSSL::X509::Store.new</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_OFF</td>
            <td>=</td>
            <td class="attr-value">LONG2FIX(SSL_SESS_CACHE_OFF)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>No session caching for client or server</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_CLIENT</td>
            <td>=</td>
            <td class="attr-value">LONG2FIX(SSL_SESS_CACHE_CLIENT)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Client sessions are added to the session cache</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_SERVER</td>
            <td>=</td>
            <td class="attr-value">LONG2FIX(SSL_SESS_CACHE_SERVER)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Server sessions are added to the session cache</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_BOTH</td>
            <td>=</td>
            <td class="attr-value">LONG2FIX(SSL_SESS_CACHE_BOTH)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Both client and server sessions are added to the session cache</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_NO_AUTO_CLEAR</td>
            <td>=</td>
            <td class="attr-value">LONG2FIX(SSL_SESS_CACHE_NO_AUTO_CLEAR)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Normally the sesison cache is checked for expired sessions every 255
connections.  Since this may lead to a delay that cannot be controlled, the
automatic flushing may be disabled and <a
href="SSLContext.html#method-i-flush_sessions">flush_sessions</a> can be
called explicitly.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_NO_INTERNAL_LOOKUP</td>
            <td>=</td>
            <td class="attr-value">LONG2FIX(SSL_SESS_CACHE_NO_INTERNAL_LOOKUP)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Always perform external lookups of sessions even if they are in the
internal cache.</p>

<p>This flag has no effect on clients</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_NO_INTERNAL_STORE</td>
            <td>=</td>
            <td class="attr-value">LONG2FIX(SSL_SESS_CACHE_NO_INTERNAL_STORE)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Never automatically store sessions in the internal store.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SESSION_CACHE_NO_INTERNAL</td>
            <td>=</td>
            <td class="attr-value">LONG2FIX(SSL_SESS_CACHE_NO_INTERNAL)</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>Enables both <a
href="SSLContext.html#SESSION_CACHE_NO_INTERNAL_LOOKUP">SESSION_CACHE_NO_INTERNAL_LOOKUP</a>
and <a
href="SSLContext.html#SESSION_CACHE_NO_INTERNAL_STORE">SESSION_CACHE_NO_INTERNAL_STORE</a>.</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">METHODS</td>
            <td>=</td>
            <td class="attr-value">ary</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>The list of available SSL/TLS methods</p></td>
            </tr>
          
        
      </table>
    


    
      <!-- Section attributes -->
      <div class="sectiontitle">Attributes</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>ca_file</td>
            <td class='attr-desc'><p>The path to a file containing a PEM-format CA certificate</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>ca_path</td>
            <td class='attr-desc'><p>The path to a directory containing CA certificates in PEM format.</p>

<p>Files are looked up by subjectâ€™s <a href="../X509.html">X509</a> nameâ€™s
hash value.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>cert</td>
            <td class='attr-desc'><p>Context certificate</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>cert_store</td>
            <td class='attr-desc'><p>An <a href="../X509/Store.html">OpenSSL::X509::Store</a> used for
certificate verification</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>client_ca</td>
            <td class='attr-desc'><p>A certificate or Array of certificates that will be sent to the client.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>client_cert_cb</td>
            <td class='attr-desc'><p>A callback invoked when a client certificate is requested by a server and
no certificate has been set.</p>

<p>The callback is invoked with a <a href="Session.html">Session</a> and must
return an Array containing an <a
href="../X509/Certificate.html">OpenSSL::X509::Certificate</a> and an <a
href="../PKey.html">OpenSSL::PKey</a>.  If any other value is returned the
handshake is suspended.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>extra_chain_cert</td>
            <td class='attr-desc'><p>An Array of extra <a href="../X509.html">X509</a> certificates to be added
to the certificate chain.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>key</td>
            <td class='attr-desc'><p>Context private key</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>options</td>
            <td class='attr-desc'><p>Sets various <a href="../../OpenSSL.html">OpenSSL</a> options.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>servername_cb</td>
            <td class='attr-desc'><p>A callback invoked at connect time to distinguish between multiple server
names.</p>

<p>The callback is invoked with an <a href="SSLSocket.html">SSLSocket</a> and
a server name.  The callback must return an <a
href="SSLContext.html">SSLContext</a> for the server name or nil.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>session_get_cb</td>
            <td class='attr-desc'><p>A callback invoked on a server when a session is proposed by the client but
the session could not be found in the serverâ€™s internal cache.</p>

<p>The callback is invoked with the <a href="SSLSocket.html">SSLSocket</a> and
session id.  The callback may return a <a href="Session.html">Session</a>
from an external cache.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>session_id_context</td>
            <td class='attr-desc'><p>Sets the context in which a session can be reused.  This allows sessions
for multiple applications to be distinguished, for exapmle, by name.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>session_new_cb</td>
            <td class='attr-desc'><p>A callback invoked when a new session was negotiatied.</p>

<p>The callback is invoked with an <a href="SSLSocket.html">SSLSocket</a>.  If
false is returned the session will be removed from the internal cache.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>session_remove_cb</td>
            <td class='attr-desc'><p>A callback invoked when a session is removed from the internal cache.</p>

<p>The callback is invoked with an <a href="SSLContext.html">SSLContext</a>
and a <a href="Session.html">Session</a>.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>ssl_timeout</td>
            <td class='attr-desc'><p>Maximum session lifetime.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>timeout</td>
            <td class='attr-desc'><p>Maximum session lifetime.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>tmp_dh_callback</td>
            <td class='attr-desc'><p>A callback invoked when DH parameters are required.</p>

<p>The callback is invoked with the <a href="Session.html">Session</a> for the
key exchange, an flag indicating the use of an export cipher and the
keylength required.</p>

<p>The callback must return an <a href="../PKey/DH.html">OpenSSL::PKey::DH</a>
instance of the correct key length.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>verify_callback</td>
            <td class='attr-desc'><p>A callback for additional certificate verification.  The callback is
invoked for each certificate in the chain.</p>

<p>The callback is invoked with two values.  <code>preverify_ok</code>
indicates indicates if the verification was passed (true) or not (false).
<code>store_context</code> is an <a
href="../X509/StoreContext.html">OpenSSL::X509::StoreContext</a> containing
the context used for certificate verification.</p>

<p>If the callback returns false verification is stopped.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>verify_depth</td>
            <td class='attr-desc'><p>Number of CA certificates to walk when verifying a certificate chain.</p></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>verify_mode</td>
            <td class='attr-desc'><p><a href="Session.html">Session</a> verification mode.</p>

<p>Valid modes are VERIFY_NONE, VERIFY_PEER, VERIFY_CLIENT_ONCE,
VERIFY_FAIL_IF_NO_PEER_CERT and defined on <a
href="../SSL.html">OpenSSL::SSL</a></p></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <a name="method-c-new"></a><b>SSLContext.new => ctx
SSLContext.new(:TLSv1) => ctx
SSLContext.new("SSLv23_client") => ctx
</b>
            
          </div>
          
          
            <div class="description">
              <p>You can get a list of valid methods with OpenSSL::SSL::SSLContext::METHODS</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_initialize(int argc, VALUE *argv, VALUE self)
{
    VALUE ssl_method;
    int i;

    for(i = 0; i &lt; numberof(ossl_sslctx_attrs); i++){
        char buf[32];
        snprintf(buf, sizeof(buf), &quot;@%s&quot;, ossl_sslctx_attrs[i]);
        rb_iv_set(self, buf, Qnil);
    }
    if (rb_scan_args(argc, argv, &quot;01&quot;, &amp;ssl_method) == 0){
        return self;
    }
    ossl_sslctx_set_ssl_version(self, ssl_method);

    return self;
}</pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-ciphers">
            
              <a name="method-i-ciphers"></a><b>ctx.ciphers => [[name, version, bits, alg_bits], ...]
</b>
            
          </div>
          
          
            <div class="description">
              <p>The list of ciphers configured for this context.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-ciphers_source')" id="l_method-i-ciphers_source">show</a>
                
              </p>
              <div id="method-i-ciphers_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_ciphers(VALUE self)
{
    SSL_CTX *ctx;
    STACK_OF(SSL_CIPHER) *ciphers;
    SSL_CIPHER *cipher;
    VALUE ary;
    int i, num;

    Data_Get_Struct(self, SSL_CTX, ctx);
    if(!ctx){
        rb_warning(&quot;SSL_CTX is not initialized.&quot;);
        return Qnil;
    }
    ciphers = ctx-&gt;cipher_list;

    if (!ciphers)
        return rb_ary_new();

    num = sk_SSL_CIPHER_num(ciphers);
    ary = rb_ary_new2(num);
    for(i = 0; i &lt; num; i++){
        cipher = sk_SSL_CIPHER_value(ciphers, i);
        rb_ary_push(ary, ossl_ssl_cipher_to_ary(cipher));
    }
    return ary;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-ciphers-3D">
            
              <a name="method-i-ciphers-3D"></a><b>ctx.ciphers = "cipher1:cipher2:..."
ctx.ciphers = [name, ...]
ctx.ciphers = [[name, version, bits, alg_bits], ...]
</b>
            
          </div>
          
          
            <div class="description">
              <p>Sets the list of available ciphers for this context.  Note in a server
context some ciphers require the appropriate certificates.  For example, an
RSA cipher can only be chosen when an RSA certificate is available.</p>

<p>See also <a href="../Cipher.html">OpenSSL::Cipher</a> and <a
href="../Cipher.html#method-c-ciphers">OpenSSL::Cipher.ciphers</a></p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-ciphers-3D_source')" id="l_method-i-ciphers-3D_source">show</a>
                
              </p>
              <div id="method-i-ciphers-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_ciphers(VALUE self, VALUE v)
{
    SSL_CTX *ctx;
    VALUE str, elem;
    int i;

    rb_check_frozen(self);
    if (NIL_P(v))
        return v;
    else if (TYPE(v) == T_ARRAY) {
        str = rb_str_new(0, 0);
        for (i = 0; i &lt; RARRAY_LEN(v); i++) {
            elem = rb_ary_entry(v, i);
            if (TYPE(elem) == T_ARRAY) elem = rb_ary_entry(elem, 0);
            elem = rb_String(elem);
            rb_str_append(str, elem);
            if (i &lt; RARRAY_LEN(v)-1) rb_str_cat2(str, &quot;:&quot;);
        }
    } else {
        str = v;
        StringValue(str);
    }

    Data_Get_Struct(self, SSL_CTX, ctx);
    if(!ctx){
        ossl_raise(eSSLError, &quot;SSL_CTX is not initialized.&quot;);
        return Qnil;
    }
    if (!SSL_CTX_set_cipher_list(ctx, RSTRING_PTR(str))) {
        ossl_raise(eSSLError, &quot;SSL_CTX_set_cipher_list:&quot;);
    }

    return v;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-flush_sessions">
            
              <a name="method-i-flush_sessions"></a><b>ctx.flush_sessions(time | nil) &rarr; self
</b>
            
          </div>
          
          
            <div class="description">
              <p>Removes sessions in the internal cache that have expired at
<code>time</code>.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-flush_sessions_source')" id="l_method-i-flush_sessions_source">show</a>
                
              </p>
              <div id="method-i-flush_sessions_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_flush_sessions(int argc, VALUE *argv, VALUE self)
{
    VALUE arg1;
    SSL_CTX *ctx;
    time_t tm = 0;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;arg1);

    Data_Get_Struct(self, SSL_CTX, ctx);

    if (NIL_P(arg1)) {
        tm = time(0);
    } else if (rb_obj_is_instance_of(arg1, rb_cTime)) {
        tm = NUM2LONG(rb_funcall(arg1, rb_intern(&quot;to_i&quot;), 0));
    } else {
        ossl_raise(rb_eArgError, &quot;arg must be Time or nil&quot;);
    }

    SSL_CTX_flush_sessions(ctx, (long)tm);

    return self;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_add">
            
              <a name="method-i-session_add"></a><b>ctx.session_add(session) &rarr; true | false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Adds <code>session</code> to the session cache</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-session_add_source')" id="l_method-i-session_add_source">show</a>
                
              </p>
              <div id="method-i-session_add_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_session_add(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;
    SSL_SESSION *sess;

    Data_Get_Struct(self, SSL_CTX, ctx);
    SafeGetSSLSession(arg, sess);

    return SSL_CTX_add_session(ctx, sess) == 1 ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_mode">
            
              <a name="method-i-session_cache_mode"></a><b>ctx.session_cache_mode &rarr; Integer
</b>
            
          </div>
          
          
            <div class="description">
              <p>The current session cache mode.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-session_cache_mode_source')" id="l_method-i-session_cache_mode_source">show</a>
                
              </p>
              <div id="method-i-session_cache_mode_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_session_cache_mode(VALUE self)
{
    SSL_CTX *ctx;

    Data_Get_Struct(self, SSL_CTX, ctx);

    return LONG2NUM(SSL_CTX_get_session_cache_mode(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_mode-3D">
            
              <a name="method-i-session_cache_mode-3D"></a><b>ctx.session_cache_mode=(integer) &rarr; Integer
</b>
            
          </div>
          
          
            <div class="description">
              <p>Sets the <a href="../SSL.html">SSL</a> session cache mode.  Bitwise-or
together the desired SESSION_CACHE_* constants to set.  See
SSL_CTX_set_session_cache_mode(3) for details.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-session_cache_mode-3D_source')" id="l_method-i-session_cache_mode-3D_source">show</a>
                
              </p>
              <div id="method-i-session_cache_mode-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_session_cache_mode(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;

    Data_Get_Struct(self, SSL_CTX, ctx);

    SSL_CTX_set_session_cache_mode(ctx, NUM2LONG(arg));

    return arg;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_size">
            
              <a name="method-i-session_cache_size"></a><b>ctx.session_cache_size &rarr; Integer
</b>
            
          </div>
          
          
            <div class="description">
              <p>Returns the current session cache size.  Zero is used to represent an
unlimited cache size.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-session_cache_size_source')" id="l_method-i-session_cache_size_source">show</a>
                
              </p>
              <div id="method-i-session_cache_size_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_session_cache_size(VALUE self)
{
    SSL_CTX *ctx;

    Data_Get_Struct(self, SSL_CTX, ctx);

    return LONG2NUM(SSL_CTX_sess_get_cache_size(ctx));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_size-3D">
            
              <a name="method-i-session_cache_size-3D"></a><b>ctx.session_cache_size=(integer) &rarr; Integer
</b>
            
          </div>
          
          
            <div class="description">
              <p>Sets the session cache size.  Returns the previously valid session cache
size.  Zero is used to represent an unlimited session cache size.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-session_cache_size-3D_source')" id="l_method-i-session_cache_size-3D_source">show</a>
                
              </p>
              <div id="method-i-session_cache_size-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_session_cache_size(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;

    Data_Get_Struct(self, SSL_CTX, ctx);

    SSL_CTX_sess_set_cache_size(ctx, NUM2LONG(arg));

    return arg;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_cache_stats">
            
              <a name="method-i-session_cache_stats"></a><b>ctx.session_cache_stats &rarr; Hash
</b>
            
          </div>
          
          
            <div class="description">
              <p>Returns a <a href="../../Hash.html">Hash</a> containing the following keys:</p>
<dl class="rdoc-list note-list"><dt>:accept
<dd>
<p>Number of started SSL/TLS handshakes in server mode</p>
</dd><dt>:accept_good
<dd>
<p>Number of established SSL/TLS sessions in server mode</p>
</dd><dt>:accept_renegotiate
<dd>
<p>Number of start renegotiations in server mode</p>
</dd><dt>:cache_full
<dd>
<p>Number of sessions that were removed due to cache overflow</p>
</dd><dt>:cache_hits
<dd>
<p>Number of successfully reused connections</p>
</dd><dt>:cache_misses
<dd>
<p>Number of sessions proposed by clients that were not found in the cache</p>
</dd><dt>:cache_num
<dd>
<p>Number of sessions in the internal session cache</p>
</dd><dt>:cb_hits
<dd>
<p>Number of sessions retrieved from the external cache in server mode</p>
</dd><dt>:connect
<dd>
<p>Number of started SSL/TLS handshakes in client mode</p>
</dd><dt>:connect_good
<dd>
<p>Number of established SSL/TLS sessions in client mode</p>
</dd><dt>:connect_renegotiate
<dd>
<p>Number of start renegotiations in client mode</p>
</dd><dt>:timeouts
<dd>
<p>Number of sessions proposed by clients that were found in the cache but had
expired due to timeouts</p>
</dd></dl>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-session_cache_stats_source')" id="l_method-i-session_cache_stats_source">show</a>
                
              </p>
              <div id="method-i-session_cache_stats_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_get_session_cache_stats(VALUE self)
{
    SSL_CTX *ctx;
    VALUE hash;

    Data_Get_Struct(self, SSL_CTX, ctx);

    hash = rb_hash_new();
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_num&quot;)), LONG2NUM(SSL_CTX_sess_number(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;connect&quot;)), LONG2NUM(SSL_CTX_sess_connect(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;connect_good&quot;)), LONG2NUM(SSL_CTX_sess_connect_good(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;connect_renegotiate&quot;)), LONG2NUM(SSL_CTX_sess_connect_renegotiate(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;accept&quot;)), LONG2NUM(SSL_CTX_sess_accept(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;accept_good&quot;)), LONG2NUM(SSL_CTX_sess_accept_good(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;accept_renegotiate&quot;)), LONG2NUM(SSL_CTX_sess_accept_renegotiate(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_hits&quot;)), LONG2NUM(SSL_CTX_sess_hits(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cb_hits&quot;)), LONG2NUM(SSL_CTX_sess_cb_hits(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_misses&quot;)), LONG2NUM(SSL_CTX_sess_misses(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_full&quot;)), LONG2NUM(SSL_CTX_sess_cache_full(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;timeouts&quot;)), LONG2NUM(SSL_CTX_sess_timeouts(ctx)));

    return hash;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-session_remove">
            
              <a name="method-i-session_remove"></a><b>ctx.session_remove(session) &rarr; true | false
</b>
            
          </div>
          
          
            <div class="description">
              <p>Removes <code>session</code> from the session cache</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-session_remove_source')" id="l_method-i-session_remove_source">show</a>
                
              </p>
              <div id="method-i-session_remove_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_session_remove(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;
    SSL_SESSION *sess;

    Data_Get_Struct(self, SSL_CTX, ctx);
    SafeGetSSLSession(arg, sess);

    return SSL_CTX_remove_session(ctx, sess) == 1 ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-set_params">
            
              <a name="method-i-set_params"></a><b>set_params</b>(params={})
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-set_params_source')" id="l_method-i-set_params_source">show</a>
                
              </p>
              <div id="method-i-set_params_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/ext/openssl/lib/openssl/ssl-internal.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">set_params</span>(<span class="ruby-identifier">params</span>={})
  <span class="ruby-identifier">params</span> = <span class="ruby-constant">DEFAULT_PARAMS</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">params</span>)
  <span class="ruby-identifier">params</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">__send__</span>(<span class="ruby-node">&quot;#{name}=&quot;</span>, <span class="ruby-identifier">value</span>) }
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">verify_mode</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">SSL</span><span class="ruby-operator">::</span><span class="ruby-constant">VERIFY_NONE</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ca_file</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ca_path</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cert_store</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cert_store</span> = <span class="ruby-constant">DEFAULT_CERT_STORE</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">params</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-setup">
            
              <a name="method-i-setup"></a><b>ctx.setup => Qtrue # first time
ctx.setup => nil # thereafter
</b>
            
          </div>
          
          
            <div class="description">
              <p>This method is called automatically when a new <a
href="SSLSocket.html">SSLSocket</a> is created. Normally you do not need to
call this method (unless you are writing an extension in C).</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-setup_source')" id="l_method-i-setup_source">show</a>
                
              </p>
              <div id="method-i-setup_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_setup(VALUE self)
{
    SSL_CTX *ctx;
    X509 *cert = NULL, *client_ca = NULL;
    X509_STORE *store;
    EVP_PKEY *key = NULL;
    char *ca_path = NULL, *ca_file = NULL;
    int i, verify_mode;
    VALUE val;

    if(OBJ_FROZEN(self)) return Qnil;
    Data_Get_Struct(self, SSL_CTX, ctx);

#if !defined(OPENSSL_NO_DH)
    if (RTEST(ossl_sslctx_get_tmp_dh_cb(self))){
        SSL_CTX_set_tmp_dh_callback(ctx, ossl_tmp_dh_callback);
    }
    else{
        SSL_CTX_set_tmp_dh_callback(ctx, ossl_default_tmp_dh_callback);
    }
#endif
    SSL_CTX_set_ex_data(ctx, ossl_ssl_ex_ptr_idx, (void*)self);

    val = ossl_sslctx_get_cert_store(self);
    if(!NIL_P(val)){
        /*
         * WORKAROUND:
         *   X509_STORE can count references, but
         *   X509_STORE_free() doesn't care it.
         *   So we won't increment it but mark it by ex_data.
         */
        store = GetX509StorePtr(val); /* NO NEED TO DUP */
        SSL_CTX_set_cert_store(ctx, store);
        SSL_CTX_set_ex_data(ctx, ossl_ssl_ex_store_p, (void*)1);
    }

    val = ossl_sslctx_get_extra_cert(self);
    if(!NIL_P(val)){
        rb_block_call(val, rb_intern(&quot;each&quot;), 0, 0, ossl_sslctx_add_extra_chain_cert_i, self);
    }

    /* private key may be bundled in certificate file. */
    val = ossl_sslctx_get_cert(self);
    cert = NIL_P(val) ? NULL : GetX509CertPtr(val); /* NO DUP NEEDED */
    val = ossl_sslctx_get_key(self);
    key = NIL_P(val) ? NULL : GetPKeyPtr(val); /* NO DUP NEEDED */
    if (cert &amp;&amp; key) {
        if (!SSL_CTX_use_certificate(ctx, cert)) {
            /* Adds a ref =&gt; Safe to FREE */
            ossl_raise(eSSLError, &quot;SSL_CTX_use_certificate:&quot;);
        }
        if (!SSL_CTX_use_PrivateKey(ctx, key)) {
            /* Adds a ref =&gt; Safe to FREE */
            ossl_raise(eSSLError, &quot;SSL_CTX_use_PrivateKey:&quot;);
        }
        if (!SSL_CTX_check_private_key(ctx)) {
            ossl_raise(eSSLError, &quot;SSL_CTX_check_private_key:&quot;);
        }
    }

    val = ossl_sslctx_get_client_ca(self);
    if(!NIL_P(val)){
        if(TYPE(val) == T_ARRAY){
            for(i = 0; i &lt; RARRAY_LEN(val); i++){
                client_ca = GetX509CertPtr(RARRAY_PTR(val)[i]);
                if (!SSL_CTX_add_client_CA(ctx, client_ca)){
                    /* Copies X509_NAME =&gt; FREE it. */
                    ossl_raise(eSSLError, &quot;SSL_CTX_add_client_CA&quot;);
                }
            }
        }
        else{
            client_ca = GetX509CertPtr(val); /* NO DUP NEEDED. */
            if (!SSL_CTX_add_client_CA(ctx, client_ca)){
                /* Copies X509_NAME =&gt; FREE it. */
                ossl_raise(eSSLError, &quot;SSL_CTX_add_client_CA&quot;);
            }
        }
    }

    val = ossl_sslctx_get_ca_file(self);
    ca_file = NIL_P(val) ? NULL : StringValuePtr(val);
    val = ossl_sslctx_get_ca_path(self);
    ca_path = NIL_P(val) ? NULL : StringValuePtr(val);
    if(ca_file || ca_path){
        if (!SSL_CTX_load_verify_locations(ctx, ca_file, ca_path))
            rb_warning(&quot;can't set verify locations&quot;);
    }

    val = ossl_sslctx_get_verify_mode(self);
    verify_mode = NIL_P(val) ? SSL_VERIFY_NONE : NUM2INT(val);
    SSL_CTX_set_verify(ctx, verify_mode, ossl_ssl_verify_callback);
    if (RTEST(ossl_sslctx_get_client_cert_cb(self)))
        SSL_CTX_set_client_cert_cb(ctx, ossl_client_cert_cb);

    val = ossl_sslctx_get_timeout(self);
    if(!NIL_P(val)) SSL_CTX_set_timeout(ctx, NUM2LONG(val));

    val = ossl_sslctx_get_verify_dep(self);
    if(!NIL_P(val)) SSL_CTX_set_verify_depth(ctx, NUM2INT(val));

    val = ossl_sslctx_get_options(self);
    if(!NIL_P(val)) SSL_CTX_set_options(ctx, NUM2LONG(val));
    rb_obj_freeze(self);

    val = ossl_sslctx_get_sess_id_ctx(self);
    if (!NIL_P(val)){
        StringValue(val);
        if (!SSL_CTX_set_session_id_context(ctx, (unsigned char *)RSTRING_PTR(val),
                                            RSTRING_LENINT(val))){
            ossl_raise(eSSLError, &quot;SSL_CTX_set_session_id_context:&quot;);
        }
    }

    if (RTEST(rb_iv_get(self, &quot;@session_get_cb&quot;))) {
        SSL_CTX_sess_set_get_cb(ctx, ossl_sslctx_session_get_cb);
        OSSL_Debug(&quot;SSL SESSION get callback added&quot;);
    }
    if (RTEST(rb_iv_get(self, &quot;@session_new_cb&quot;))) {
        SSL_CTX_sess_set_new_cb(ctx, ossl_sslctx_session_new_cb);
        OSSL_Debug(&quot;SSL SESSION new callback added&quot;);
    }
    if (RTEST(rb_iv_get(self, &quot;@session_remove_cb&quot;))) {
        SSL_CTX_sess_set_remove_cb(ctx, ossl_sslctx_session_remove_cb);
        OSSL_Debug(&quot;SSL SESSION remove callback added&quot;);
    }

#ifdef HAVE_SSL_SET_TLSEXT_HOST_NAME
    val = rb_iv_get(self, &quot;@servername_cb&quot;);
    if (!NIL_P(val)) {
        SSL_CTX_set_tlsext_servername_callback(ctx, ssl_servername_cb);
        OSSL_Debug(&quot;SSL TLSEXT servername callback added&quot;);
    }
#endif

    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-ssl_version-3D">
            
              <a name="method-i-ssl_version-3D"></a><b>ctx.ssl_version = :TLSv1
ctx.ssl_version = "SSLv23_client"
</b>
            
          </div>
          
          
            <div class="description">
              <p>You can get a list of valid versions with OpenSSL::SSL::SSLContext::METHODS</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-ssl_version-3D_source')" id="l_method-i-ssl_version-3D_source">show</a>
                
              </p>
              <div id="method-i-ssl_version-3D_source" class="dyn-source">
                <pre>static VALUE
ossl_sslctx_set_ssl_version(VALUE self, VALUE ssl_method)
{
    SSL_METHOD *method = NULL;
    const char *s;
    int i;

    SSL_CTX *ctx;
    if(TYPE(ssl_method) == T_SYMBOL)
        s = rb_id2name(SYM2ID(ssl_method));
    else
        s =  StringValuePtr(ssl_method);
    for (i = 0; i &lt; numberof(ossl_ssl_method_tab); i++) {
        if (strcmp(ossl_ssl_method_tab[i].name, s) == 0) {
            method = ossl_ssl_method_tab[i].func();
            break;
        }
    }
    if (!method) {
        ossl_raise(rb_eArgError, &quot;unknown SSL method `%s'.&quot;, s);
    }
    Data_Get_Struct(self, SSL_CTX, ctx);
    if (SSL_CTX_set_ssl_version(ctx, method) != 1) {
        ossl_raise(eSSLError, &quot;SSL_CTX_set_ssl_version:&quot;);
    }

    return ssl_method;
}</pre>
              </div>
            </div>
            
          </div>
                    </div>
    </div>
  </body>
</html>    