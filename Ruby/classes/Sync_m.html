<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Sync_m</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Module</span> 
            Sync_m 
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/Users/fschumac/_rvm/src/ruby-1_9_3-p0/lib/sync_rb.html">/Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>A module that provides a two-phase lock with a counter.</p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Sync_m/Err.html">Sync_m::Err</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-append_features">append_features</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-define_aliases">define_aliases</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-extend_object">extend_object</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-sync_exclusive-3F">sync_exclusive?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_extend">sync_extend</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_inspect">sync_inspect</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_lock">sync_lock</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_locked-3F">sync_locked?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_shared-3F">sync_shared?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_synchronize">sync_synchronize</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_try_lock">sync_try_lock</a>,
              </li>
            
              
              <li>
                <a href="#method-i-sync_unlock">sync_unlock</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">RCS_ID</td>
            <td>=</td>
            <td class="attr-value">'-$Id: sync.rb 32281 2011-06-29 03:09:34Z drbrain $-'</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">UN</td>
            <td>=</td>
            <td class="attr-value">:UN</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"><p>lock mode</p></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">SH</td>
            <td>=</td>
            <td class="attr-value">:SH</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
          <tr valign='top'>
            <td class="attr-name">EX</td>
            <td>=</td>
            <td class="attr-value">:EX</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    
      <!-- Section attributes -->
      <div class="sectiontitle">Attributes</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>sync_ex_count</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>sync_ex_locker</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>sync_mode</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>sync_sh_locker</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>sync_upgrade_waiting</td>
            <td class='attr-desc'></td>
          </tr>
        
          <tr valign='top'>
            <td class='attr-rw'>
              [RW]
            </td>
            <td class='attr-name'>sync_waiting</td>
            <td class='attr-desc'></td>
          </tr>
        
      </table>
    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-append_features">
            
              <a name="method-c-append_features"></a><b>append_features</b>(cl)
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-append_features_source')" id="l_method-c-append_features_source">show</a>
                
              </p>
              <div id="method-c-append_features_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">Sync_m</span>.<span class="ruby-identifier">append_features</span>(<span class="ruby-identifier">cl</span>)
  <span class="ruby-keyword">super</span>
  <span class="ruby-comment"># do nothing for Modules</span>
  <span class="ruby-comment"># make aliases for Classes.</span>
  <span class="ruby-identifier">define_aliases</span>(<span class="ruby-identifier">cl</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cl</span>.<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">Module</span>)
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-define_aliases">
            
              <a name="method-c-define_aliases"></a><b>define_aliases</b>(cl)
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-define_aliases_source')" id="l_method-c-define_aliases_source">show</a>
                
              </p>
              <div id="method-c-define_aliases_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 79</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">Sync_m</span>.<span class="ruby-identifier">define_aliases</span>(<span class="ruby-identifier">cl</span>)
  <span class="ruby-identifier">cl</span>.<span class="ruby-identifier">module_eval</span> <span class="ruby-string">%q{
    alias locked? sync_locked?
    alias shared? sync_shared?
    alias exclusive? sync_exclusive?
    alias lock sync_lock
    alias unlock sync_unlock
    alias try_lock sync_try_lock
    alias synchronize sync_synchronize
  }</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-extend_object">
            
              <a name="method-c-extend_object"></a><b>extend_object</b>(obj)
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-extend_object_source')" id="l_method-c-extend_object_source">show</a>
                
              </p>
              <div id="method-c-extend_object_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 99</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">Sync_m</span>.<span class="ruby-identifier">extend_object</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-keyword">super</span>
  <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">sync_extend</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <a name="method-c-new"></a><b>new</b>(*args)
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">initialize</span>(*<span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">super</span>
  <span class="ruby-identifier">sync_initialize</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-sync_exclusive-3F">
            
              <a name="method-i-sync_exclusive-3F"></a><b>sync_exclusive?</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sync_exclusive-3F_source')" id="l_method-i-sync_exclusive-3F_source">show</a>
                
              </p>
              <div id="method-i-sync_exclusive-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 126</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sync_exclusive?</span>
  <span class="ruby-identifier">sync_mode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">EX</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-sync_extend">
            
              <a name="method-i-sync_extend"></a><b>sync_extend</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sync_extend_source')" id="l_method-i-sync_extend_source">show</a>
                
              </p>
              <div id="method-i-sync_extend_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sync_extend</span>
  <span class="ruby-keyword">unless</span> (<span class="ruby-keyword">defined?</span> <span class="ruby-identifier">locked?</span> <span class="ruby-keyword">and</span>
          <span class="ruby-keyword">defined?</span> <span class="ruby-identifier">shared?</span> <span class="ruby-keyword">and</span>
          <span class="ruby-keyword">defined?</span> <span class="ruby-identifier">exclusive?</span> <span class="ruby-keyword">and</span>
          <span class="ruby-keyword">defined?</span> <span class="ruby-identifier">lock</span> <span class="ruby-keyword">and</span>
          <span class="ruby-keyword">defined?</span> <span class="ruby-identifier">unlock</span> <span class="ruby-keyword">and</span>
          <span class="ruby-keyword">defined?</span> <span class="ruby-identifier">try_lock</span> <span class="ruby-keyword">and</span>
          <span class="ruby-keyword">defined?</span> <span class="ruby-identifier">synchronize</span>)
    <span class="ruby-constant">Sync_m</span>.<span class="ruby-identifier">define_aliases</span>(<span class="ruby-identifier">singleton_class</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">sync_initialize</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-sync_inspect">
            
              <a name="method-i-sync_inspect"></a><b>sync_inspect</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sync_inspect_source')" id="l_method-i-sync_inspect_source">show</a>
                
              </p>
              <div id="method-i-sync_inspect_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sync_inspect</span>
  <span class="ruby-identifier">sync_iv</span> = <span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">select</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">iv</span><span class="ruby-operator">|</span> <span class="ruby-regexp">%r^@sync_/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">iv</span>.<span class="ruby-identifier">id2name</span>}.<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">iv</span><span class="ruby-operator">|</span> <span class="ruby-identifier">iv</span>.<span class="ruby-identifier">id2name</span> <span class="ruby-operator">+</span> <span class="ruby-string">'='</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">instance_eval</span>(<span class="ruby-identifier">iv</span>.<span class="ruby-identifier">id2name</span>).<span class="ruby-identifier">inspect</span>}.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;,&quot;</span>)
  <span class="ruby-identifier">print</span> <span class="ruby-node">&quot;&lt;#{self.class}.extend Sync_m: #{inspect}, &lt;Sync_m: #{sync_iv}&gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-sync_lock">
            
              <a name="method-i-sync_lock"></a><b>sync_lock</b>(m = EX)
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sync_lock_source')" id="l_method-i-sync_lock_source">show</a>
                
              </p>
              <div id="method-i-sync_lock_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sync_lock</span>(<span class="ruby-identifier">m</span> = <span class="ruby-constant">EX</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">unlock</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">==</span> <span class="ruby-constant">UN</span>

  <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span>
    <span class="ruby-ivar">@sync_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">sync_try_lock_sub</span>(<span class="ruby-identifier">m</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">sync_sh_locker</span>[<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>]
          <span class="ruby-identifier">sync_upgrade_waiting</span>.<span class="ruby-identifier">push</span> [<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>, <span class="ruby-identifier">sync_sh_locker</span>[<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>]]
          <span class="ruby-identifier">sync_sh_locker</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">sync_waiting</span>.<span class="ruby-identifier">push</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@sync_mutex</span>.<span class="ruby-identifier">sleep</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-sync_locked-3F">
            
              <a name="method-i-sync_locked-3F"></a><b>sync_locked?</b>()
            
          </div>
          
          
            <div class="description">
              <p>accessing</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sync_locked-3F_source')" id="l_method-i-sync_locked-3F_source">show</a>
                
              </p>
              <div id="method-i-sync_locked-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 118</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sync_locked?</span>
  <span class="ruby-identifier">sync_mode</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">UN</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-sync_shared-3F">
            
              <a name="method-i-sync_shared-3F"></a><b>sync_shared?</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sync_shared-3F_source')" id="l_method-i-sync_shared-3F_source">show</a>
                
              </p>
              <div id="method-i-sync_shared-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sync_shared?</span>
  <span class="ruby-identifier">sync_mode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SH</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-sync_synchronize">
            
              <a name="method-i-sync_synchronize"></a><b>sync_synchronize</b>(mode = EX)
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sync_synchronize_source')" id="l_method-i-sync_synchronize_source">show</a>
                
              </p>
              <div id="method-i-sync_synchronize_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 224</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sync_synchronize</span>(<span class="ruby-identifier">mode</span> = <span class="ruby-constant">EX</span>)
  <span class="ruby-identifier">sync_lock</span>(<span class="ruby-identifier">mode</span>)
  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">yield</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-identifier">sync_unlock</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-sync_try_lock">
            
              <a name="method-i-sync_try_lock"></a><b>sync_try_lock</b>(mode = EX)
            
          </div>
          
          
            <div class="description">
              <p>locking methods.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sync_try_lock_source')" id="l_method-i-sync_try_lock_source">show</a>
                
              </p>
              <div id="method-i-sync_try_lock_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 131</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sync_try_lock</span>(<span class="ruby-identifier">mode</span> = <span class="ruby-constant">EX</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">unlock</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">mode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">UN</span>
  <span class="ruby-ivar">@sync_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">sync_try_lock_sub</span>(<span class="ruby-identifier">mode</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-sync_unlock">
            
              <a name="method-i-sync_unlock"></a><b>sync_unlock</b>(m = EX)
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-sync_unlock_source')" id="l_method-i-sync_unlock_source">show</a>
                
              </p>
              <div id="method-i-sync_unlock_source" class="dyn-source">
                <pre><span class="ruby-comment"># File /Users/fschumac/.rvm/src/ruby-1.9.3-p0/lib/sync.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">sync_unlock</span>(<span class="ruby-identifier">m</span> = <span class="ruby-constant">EX</span>)
  <span class="ruby-identifier">wakeup_threads</span> = []
  <span class="ruby-ivar">@sync_mutex</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">sync_mode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">UN</span>
      <span class="ruby-constant">Err</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownLocker</span>.<span class="ruby-constant">Fail</span>(<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">m</span> = <span class="ruby-identifier">sync_mode</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> <span class="ruby-operator">==</span> <span class="ruby-constant">EX</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">sync_mode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">SH</span>

    <span class="ruby-identifier">runnable</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">m</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">UN</span>
      <span class="ruby-constant">Err</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownLocker</span>.<span class="ruby-constant">Fail</span>(<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)

    <span class="ruby-keyword">when</span> <span class="ruby-constant">EX</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">sync_ex_locker</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-keyword">self</span>.<span class="ruby-identifier">sync_ex_count</span> = <span class="ruby-identifier">sync_ex_count</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>) <span class="ruby-operator">==</span> <span class="ruby-number">0</span>
          <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sync_ex_locker</span> = <span class="ruby-keyword">nil</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">sync_sh_locker</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sync_mode</span> = <span class="ruby-constant">SH</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sync_mode</span> = <span class="ruby-constant">UN</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">runnable</span> = <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-constant">Err</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownLocker</span>.<span class="ruby-constant">Fail</span>(<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">when</span> <span class="ruby-constant">SH</span>
      <span class="ruby-keyword">if</span> (<span class="ruby-identifier">count</span> = <span class="ruby-identifier">sync_sh_locker</span>[<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>]).<span class="ruby-identifier">nil?</span>
        <span class="ruby-constant">Err</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownLocker</span>.<span class="ruby-constant">Fail</span>(<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">if</span> (<span class="ruby-identifier">sync_sh_locker</span>[<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>] = <span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-number">1</span>) <span class="ruby-operator">==</span> <span class="ruby-number">0</span>
          <span class="ruby-identifier">sync_sh_locker</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>)
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">sync_sh_locker</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">sync_ex_count</span> <span class="ruby-operator">==</span> <span class="ruby-number">0</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sync_mode</span> = <span class="ruby-constant">UN</span>
            <span class="ruby-identifier">runnable</span> = <span class="ruby-keyword">true</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">runnable</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">sync_upgrade_waiting</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-number">0</span>
        <span class="ruby-identifier">th</span>, <span class="ruby-identifier">count</span> = <span class="ruby-identifier">sync_upgrade_waiting</span>.<span class="ruby-identifier">shift</span>
        <span class="ruby-identifier">sync_sh_locker</span>[<span class="ruby-identifier">th</span>] = <span class="ruby-identifier">count</span>
        <span class="ruby-identifier">th</span>.<span class="ruby-identifier">wakeup</span>
        <span class="ruby-identifier">wakeup_threads</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">th</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">wait</span> = <span class="ruby-identifier">sync_waiting</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">sync_waiting</span> = []
        <span class="ruby-keyword">for</span> <span class="ruby-identifier">th</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">wait</span>
          <span class="ruby-identifier">th</span>.<span class="ruby-identifier">wakeup</span>
          <span class="ruby-identifier">wakeup_threads</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">th</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">for</span> <span class="ruby-identifier">th</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">wakeup_threads</span>
    <span class="ruby-identifier">th</span>.<span class="ruby-identifier">run</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>
    </div>
  </body>
</html>    