<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>ActionMailerTest</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            ActionMailerTest 
            
                <span class="parent">&lt; 
                    
                    <a href="Test/Unit/TestCase.html">Test::Unit::TestCase</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/actionmailer/test/old_base/mail_service_test_rb.html">actionmailer/test/old_base/mail_service_test.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-encode">encode</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-new_mail">new_mail</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-setup">setup</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-teardown">teardown</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_attachment_with_custom_header">test_attachment_with_custom_header</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_cancelled_account">test_cancelled_account</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_cc_bcc">test_cc_bcc</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_custom_template">test_custom_template</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_custom_templating_extension">test_custom_templating_extension</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_deliveries_array">test_deliveries_array</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_doesnt_raise_errors_when_raise_delivery_errors_is_false">test_doesnt_raise_errors_when_raise_delivery_errors_is_false</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_from_with_name_for_smtp">test_from_with_name_for_smtp</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_from_without_name_for_smtp">test_from_without_name_for_smtp</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_iso_charset">test_iso_charset</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_nested_parts">test_nested_parts</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_nested_parts_with_body">test_nested_parts_with_body</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_perform_deliveries_flag">test_perform_deliveries_flag</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_performs_delivery_via_sendmail">test_performs_delivery_via_sendmail</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_reply_to">test_reply_to</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_signed_up">test_signed_up</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_unencoded_subject">test_unencoded_subject</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_unquote_quoted_printable_subject">test_unquote_quoted_printable_subject</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
        
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-encode">
            
              <a name="method-i-encode"></a><b>encode</b>( text, charset=&quot;UTF-8&quot; )
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-encode_source')" id="l_method-i-encode_source">show</a>
                
              </p>
              <div id="method-i-encode_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 319</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">encode</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">charset</span>=<span class="ruby-string">&quot;UTF-8&quot;</span> )
  <span class="ruby-constant">Mail</span><span class="ruby-operator">::</span><span class="ruby-constant">Encodings</span>.<span class="ruby-identifier">q_value_encode</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">charset</span> )
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-new_mail">
            
              <a name="method-i-new_mail"></a><b>new_mail</b>( charset=&quot;UTF-8&quot; )
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-new_mail_source')" id="l_method-i-new_mail_source">show</a>
                
              </p>
              <div id="method-i-new_mail_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 323</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">new_mail</span>( <span class="ruby-identifier">charset</span>=<span class="ruby-string">&quot;UTF-8&quot;</span> )
  <span class="ruby-identifier">mail</span> = <span class="ruby-constant">Mail</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">charset</span> = <span class="ruby-identifier">charset</span>
  <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">mime_version</span> = <span class="ruby-string">&quot;1.0&quot;</span>
  <span class="ruby-identifier">mail</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-setup">
            
              <a name="method-i-setup"></a><b>setup</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-setup_source')" id="l_method-i-setup_source">show</a>
                
              </p>
              <div id="method-i-setup_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 330</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">setup</span>
  <span class="ruby-identifier">set_delivery_method</span> <span class="ruby-value">:test</span>
  <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">perform_deliveries</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">raise_delivery_errors</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Deprecation</span>.<span class="ruby-identifier">silenced</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-ivar">@recipient</span> = <span class="ruby-string">'test@localhost'</span>

  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-value">:test</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-teardown">
            
              <a name="method-i-teardown"></a><b>teardown</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-teardown_source')" id="l_method-i-teardown_source">show</a>
                
              </p>
              <div id="method-i-teardown_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 342</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">teardown</span>
  <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Deprecation</span>.<span class="ruby-identifier">silenced</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">restore_delivery_method</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_attachment_with_custom_header">
            
              <a name="method-i-test_attachment_with_custom_header"></a><b>test_attachment_with_custom_header</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_attachment_with_custom_header_source')" id="l_method-i-test_attachment_with_custom_header_source">show</a>
                
              </p>
              <div id="method-i-test_attachment_with_custom_header_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 379</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_attachment_with_custom_header</span>
  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">attachment_with_custom_header</span>(<span class="ruby-ivar">@recipient</span>) }
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">header</span>[<span class="ruby-string">'content-id'</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&lt;test@test.com&gt;&quot;</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_cancelled_account">
            
              <a name="method-i-test_cancelled_account"></a><b>test_cancelled_account</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_cancelled_account_source')" id="l_method-i-test_cancelled_account_source">show</a>
                
              </p>
              <div id="method-i-test_cancelled_account_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 453</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_cancelled_account</span>
  <span class="ruby-identifier">expected</span>         = <span class="ruby-identifier">new_mail</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;[Cancelled] Goodbye #{@recipient}&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-node">&quot;Goodbye, Mr. #{@recipient}&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-string">&quot;system@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span>(<span class="ruby-number">2004</span>, <span class="ruby-number">12</span>, <span class="ruby-number">12</span>)

  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">cancelled_account</span>(<span class="ruby-ivar">@recipient</span>) }
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">created</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>

  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">cancelled_account</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span> }
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">delivered</span> = <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">encoded</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_cc_bcc">
            
              <a name="method-i-test_cc_bcc"></a><b>test_cc_bcc</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_cc_bcc_source')" id="l_method-i-test_cc_bcc_source">show</a>
                
              </p>
              <div id="method-i-test_cc_bcc_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 477</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_cc_bcc</span>
  <span class="ruby-identifier">expected</span>         = <span class="ruby-identifier">new_mail</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-string">&quot;testing bcc/cc&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-string">&quot;Nothing to see here.&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-string">&quot;system@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">cc</span>      = <span class="ruby-string">&quot;nobody@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">bcc</span>     = <span class="ruby-string">&quot;root@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-number">2004</span>, <span class="ruby-number">12</span>, <span class="ruby-number">12</span>

  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">cc_bcc</span> <span class="ruby-ivar">@recipient</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">created</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>

  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">cc_bcc</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">delivered</span> = <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">encoded</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_custom_template">
            
              <a name="method-i-test_custom_template"></a><b>test_custom_template</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_custom_template_source')" id="l_method-i-test_custom_template_source">show</a>
                
              </p>
              <div id="method-i-test_custom_template_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 417</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_custom_template</span>
  <span class="ruby-identifier">expected</span>         = <span class="ruby-identifier">new_mail</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;[Signed up] Welcome #{@recipient}&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-node">&quot;Hello there,\n\nMr. #{@recipient}&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-string">&quot;system@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span>(<span class="ruby-number">2004</span>, <span class="ruby-number">12</span>, <span class="ruby-number">12</span>)

  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">custom_template</span>(<span class="ruby-ivar">@recipient</span>) }
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">created</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_custom_templating_extension">
            
              <a name="method-i-test_custom_templating_extension"></a><b>test_custom_templating_extension</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_custom_templating_extension_source')" id="l_method-i-test_custom_templating_extension_source">show</a>
                
              </p>
              <div id="method-i-test_custom_templating_extension_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 433</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_custom_templating_extension</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">Template</span>.<span class="ruby-identifier">template_handler_extensions</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;haml&quot;</span>), <span class="ruby-string">&quot;haml extension was not registered&quot;</span>

  <span class="ruby-comment"># N.b., custom_templating_extension.text.plain.haml is expected to be in fixtures/test_mailer directory</span>
  <span class="ruby-identifier">expected</span>         = <span class="ruby-identifier">new_mail</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;[Signed up] Welcome #{@recipient}&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-node">&quot;Hello there, \n\nMr. #{@recipient}&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-string">&quot;system@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span>(<span class="ruby-number">2004</span>, <span class="ruby-number">12</span>, <span class="ruby-number">12</span>)

  <span class="ruby-comment"># Now that the template is registered, there should be one part. The text/plain part.</span>
  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">custom_templating_extension</span>(<span class="ruby-ivar">@recipient</span>) }
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">2</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">'text/plain'</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-number">0</span>].<span class="ruby-identifier">mime_type</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">'text/html'</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-number">1</span>].<span class="ruby-identifier">mime_type</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_deliveries_array">
            
              <a name="method-i-test_deliveries_array"></a><b>test_deliveries_array</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_deliveries_array_source')" id="l_method-i-test_deliveries_array_source">show</a>
                
              </p>
              <div id="method-i-test_deliveries_array_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 638</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_deliveries_array</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">0</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">signed_up</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">1</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_doesnt_raise_errors_when_raise_delivery_errors_is_false">
            
              <a name="method-i-test_doesnt_raise_errors_when_raise_delivery_errors_is_false"></a><b>test_doesnt_raise_errors_when_raise_delivery_errors_is_false</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_doesnt_raise_errors_when_raise_delivery_errors_is_false_source')" id="l_method-i-test_doesnt_raise_errors_when_raise_delivery_errors_is_false_source">show</a>
                
              </p>
              <div id="method-i-test_doesnt_raise_errors_when_raise_delivery_errors_is_false_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 655</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_doesnt_raise_errors_when_raise_delivery_errors_is_false</span>
  <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">raise_delivery_errors</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">Mail</span><span class="ruby-operator">::</span><span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">any_instance</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-value">:deliver!</span>).<span class="ruby-identifier">raises</span>(<span class="ruby-constant">Exception</span>)
  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">signed_up</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_from_with_name_for_smtp">
            
              <a name="method-i-test_from_with_name_for_smtp"></a><b>test_from_with_name_for_smtp</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_from_with_name_for_smtp_source')" id="l_method-i-test_from_with_name_for_smtp_source">show</a>
                
              </p>
              <div id="method-i-test_from_with_name_for_smtp_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 520</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_from_with_name_for_smtp</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-value">:smtp</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">from_with_name</span>.<span class="ruby-identifier">deliver</span>

  <span class="ruby-identifier">mail</span> = <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">mail</span>
  <span class="ruby-identifier">mail</span>, <span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span> = <span class="ruby-identifier">mail</span>

  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-string">'root@loudthinking.com'</span>], <span class="ruby-identifier">to</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">'system@loudthinking.com'</span>, <span class="ruby-identifier">from</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_from_without_name_for_smtp">
            
              <a name="method-i-test_from_without_name_for_smtp"></a><b>test_from_without_name_for_smtp</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_from_without_name_for_smtp_source')" id="l_method-i-test_from_without_name_for_smtp_source">show</a>
                
              </p>
              <div id="method-i-test_from_without_name_for_smtp_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 508</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_from_without_name_for_smtp</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-value">:smtp</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">from_without_name</span>.<span class="ruby-identifier">deliver</span>

  <span class="ruby-identifier">mail</span> = <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">mail</span>
  <span class="ruby-identifier">mail</span>, <span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span> = <span class="ruby-identifier">mail</span>

  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-string">'root@loudthinking.com'</span>], <span class="ruby-identifier">to</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">'system@loudthinking.com'</span>, <span class="ruby-identifier">from</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_iso_charset">
            
              <a name="method-i-test_iso_charset"></a><b>test_iso_charset</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_iso_charset_source')" id="l_method-i-test_iso_charset_source">show</a>
                
              </p>
              <div id="method-i-test_iso_charset_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 568</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_iso_charset</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-value">:test</span>
  <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>( <span class="ruby-string">&quot;iso-8859-1&quot;</span> )
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-identifier">encode</span> <span class="ruby-string">&quot;testing isø charsets&quot;</span>, <span class="ruby-string">&quot;iso-8859-1&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-string">&quot;Nothing to see here.&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-string">&quot;system@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">cc</span>      = <span class="ruby-string">&quot;nobody@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">bcc</span>     = <span class="ruby-string">&quot;root@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-number">2004</span>, <span class="ruby-number">12</span>, <span class="ruby-number">12</span>

  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">iso_charset</span> <span class="ruby-ivar">@recipient</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>

  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">created</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>

  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">iso_charset</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">delivered</span> = <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">delivered</span>

  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">encoded</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_nested_parts">
            
              <a name="method-i-test_nested_parts"></a><b>test_nested_parts</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_nested_parts_source')" id="l_method-i-test_nested_parts_source">show</a>
                
              </p>
              <div id="method-i-test_nested_parts_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 347</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_nested_parts</span>
  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">nested_multipart</span>(<span class="ruby-ivar">@recipient</span>)}
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">2</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">2</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">size</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;multipart/mixed&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">mime_type</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;multipart/alternative&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-number">0</span>].<span class="ruby-identifier">mime_type</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;bar&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-number">0</span>].<span class="ruby-identifier">header</span>[<span class="ruby-string">'foo'</span>].<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-number">0</span>].<span class="ruby-identifier">charset</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;text/plain&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-number">0</span>].<span class="ruby-identifier">parts</span>[<span class="ruby-number">0</span>].<span class="ruby-identifier">mime_type</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;text/html&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-number">0</span>].<span class="ruby-identifier">parts</span>[<span class="ruby-number">1</span>].<span class="ruby-identifier">mime_type</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;application/octet-stream&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-number">1</span>].<span class="ruby-identifier">mime_type</span>

<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_nested_parts_with_body">
            
              <a name="method-i-test_nested_parts_with_body"></a><b>test_nested_parts_with_body</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_nested_parts_with_body_source')" id="l_method-i-test_nested_parts_with_body_source">show</a>
                
              </p>
              <div id="method-i-test_nested_parts_with_body_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 363</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_nested_parts_with_body</span>
  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">nested_multipart_with_body</span>(<span class="ruby-ivar">@recipient</span>)
  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">nested_multipart_with_body</span>(<span class="ruby-ivar">@recipient</span>)}

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">1</span>,<span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">2</span>,<span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">size</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;multipart/mixed&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">mime_type</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;multipart/alternative&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">mime_type</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;text/plain&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">mime_type</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;Nothing to see here.&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;text/html&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">second</span>.<span class="ruby-identifier">mime_type</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;&lt;b&gt;test&lt;/b&gt; HTML&lt;br/&gt;&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">second</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">to_s</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_perform_deliveries_flag">
            
              <a name="method-i-test_perform_deliveries_flag"></a><b>test_perform_deliveries_flag</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_perform_deliveries_flag_source')" id="l_method-i-test_perform_deliveries_flag_source">show</a>
                
              </p>
              <div id="method-i-test_perform_deliveries_flag_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 646</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_perform_deliveries_flag</span>
  <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">perform_deliveries</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">signed_up</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">0</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">perform_deliveries</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">signed_up</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">1</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_performs_delivery_via_sendmail">
            
              <a name="method-i-test_performs_delivery_via_sendmail"></a><b>test_performs_delivery_via_sendmail</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_performs_delivery_via_sendmail_source')" id="l_method-i-test_performs_delivery_via_sendmail_source">show</a>
                
              </p>
              <div id="method-i-test_performs_delivery_via_sendmail_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 661</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_performs_delivery_via_sendmail</span>
  <span class="ruby-constant">IO</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-value">:popen</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">with</span>(<span class="ruby-string">'/usr/sbin/sendmail -i -t -f &quot;system@loudthinking.com&quot; test@localhost'</span>, <span class="ruby-string">'w+'</span>)
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-value">:sendmail</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">signed_up</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_reply_to">
            
              <a name="method-i-test_reply_to"></a><b>test_reply_to</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_reply_to_source')" id="l_method-i-test_reply_to_source">show</a>
                
              </p>
              <div id="method-i-test_reply_to_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 532</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_reply_to</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-value">:test</span>

  <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>

  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>       = <span class="ruby-ivar">@recipient</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span>  = <span class="ruby-string">&quot;testing reply_to&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>     = <span class="ruby-string">&quot;Nothing to see here.&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>     = <span class="ruby-string">&quot;system@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">reply_to</span> = <span class="ruby-string">&quot;atraver@gmail.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>     = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-number">2008</span>, <span class="ruby-number">5</span>, <span class="ruby-number">23</span>

  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">different_reply_to</span> <span class="ruby-ivar">@recipient</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>

  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">created</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>

  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">different_reply_to</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">delivered</span> = <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">delivered</span>

  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">encoded</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_signed_up">
            
              <a name="method-i-test_signed_up"></a><b>test_signed_up</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_signed_up_source')" id="l_method-i-test_signed_up_source">show</a>
                
              </p>
              <div id="method-i-test_signed_up_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 385</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_signed_up</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-value">:test</span>

  <span class="ruby-constant">Time</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-value">:now</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)

  <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;[Signed up] Welcome #{@recipient}&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-node">&quot;Hello there,\n\nMr. #{@recipient}&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-string">&quot;system@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>

  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">signed_up</span>(<span class="ruby-ivar">@recipient</span>) }
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>

  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">created</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>

  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">signed_up</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span> }

  <span class="ruby-identifier">delivered</span> = <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">delivered</span>

  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">encoded</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_unencoded_subject">
            
              <a name="method-i-test_unencoded_subject"></a><b>test_unencoded_subject</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_unencoded_subject_source')" id="l_method-i-test_unencoded_subject_source">show</a>
                
              </p>
              <div id="method-i-test_unencoded_subject_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 603</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_unencoded_subject</span>
  <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-value">:test</span>
  <span class="ruby-identifier">expected</span>         = <span class="ruby-identifier">new_mail</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-string">&quot;testing unencoded subject&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-string">&quot;Nothing to see here.&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-string">&quot;system@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">cc</span>      = <span class="ruby-string">&quot;nobody@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">bcc</span>     = <span class="ruby-string">&quot;root@loudthinking.com&quot;</span>
  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-number">2004</span>, <span class="ruby-number">12</span>, <span class="ruby-number">12</span>

  <span class="ruby-identifier">created</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">unencoded_subject</span> <span class="ruby-ivar">@recipient</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>

  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">created</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>

  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">unencoded_subject</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">delivered</span> = <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">delivered</span>

  <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>
  <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">message_id</span> = <span class="ruby-string">'&lt;123@456&gt;'</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">delivered</span>.<span class="ruby-identifier">encoded</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_unquote_quoted_printable_subject">
            
              <a name="method-i-test_unquote_quoted_printable_subject"></a><b>test_unquote_quoted_printable_subject</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_unquote_quoted_printable_subject_source')" id="l_method-i-test_unquote_quoted_printable_subject_source">show</a>
                
              </p>
              <div id="method-i-test_unquote_quoted_printable_subject_source" class="dyn-source">
                <pre><span class="ruby-comment"># File actionmailer/test/old_base/mail_service_test.rb, line 667</span>
  <span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_unquote_quoted_printable_subject</span>
    <span class="ruby-identifier">msg</span> = <span class="ruby-string">&quot;From: me@example.com
Subject: =?UTF-8?Q?testing_testing_=D6=A4?=
Content-Type: text/plain; charset=iso-8859-1

The body
EOF
    mail = Mail.new(msg)
    assert_equal &quot;testing testing \326\244&quot;, mail.subject
    assert_equal &quot;Subject: =?UTF-8?Q?testing_testing_=D6=A4?=\r\n&quot;, mail[:subject].encoded
  end

  def test_unquote_7bit_subject
    msg = &lt;&lt;EOF
From: me@example.com
Subject: this == working?
Content-Type: text/plain; charset=iso-8859-1

The body
EOF
    mail = Mail.new(msg)
    assert_equal &quot;this == working?&quot;, mail.subject
    assert_equal &quot;Subject: this == working?\r\n&quot;, mail[:subject].encoded
  end

  def test_unquote_7bit_body
    msg = &lt;&lt;EOF
From: me@example.com
Subject: subject
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 7bit

The=3Dbody
EOF
    mail = Mail.new(msg)
    assert_equal &quot;The=3Dbody&quot;, mail.body.to_s.strip
    assert_equal &quot;The=3Dbody&quot;, mail.body.encoded.strip
  end

  def test_unquote_quoted_printable_body
    msg = &lt;&lt;EOF
From: me@example.com
Subject: subject
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: quoted-printable

The=3Dbody
EOF
    mail = Mail.new(msg)
    assert_equal &quot;The=body&quot;, mail.body.to_s.strip
    assert_equal &quot;The=3Dbody=&quot;, mail.body.encoded.strip
  end

  def test_unquote_base64_body
    msg = &lt;&lt;EOF
From: me@example.com
Subject: subject
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: base64

VGhlIGJvZHk=
EOF
    mail = Mail.new(msg)
    assert_equal &quot;The body&quot;, mail.body.to_s.strip
    assert_equal &quot;VGhlIGJvZHk=&quot;, mail.body.encoded.strip
  end

  def test_extended_headers
    @recipient = &quot;Grytøyr &lt;test@localhost&gt;&quot;

    expected = new_mail &quot;iso-8859-1&quot;
    expected.to      = @recipient
    expected.subject = &quot;testing extended headers&quot;
    expected.body    = &quot;Nothing to see here.&quot;
    expected.from    = &quot;Grytøyr &lt;stian1@example.net&gt;&quot;
    expected.cc      = &quot;Grytøyr &lt;stian2@example.net&gt;&quot;
    expected.bcc     = &quot;Grytøyr &lt;stian3@example.net&gt;&quot;
    expected.date    = Time.local 2004, 12, 12

    created = nil
    assert_nothing_raised do
      created = TestMailer.extended_headers @recipient
    end

    assert_not_nil created
    expected.message_id = '&lt;123@456&gt;'
    created.message_id = '&lt;123@456&gt;'

    assert_equal expected.encoded, created.encoded

    assert_nothing_raised do
      TestMailer.extended_headers(@recipient).deliver
    end

    delivered = ActionMailer::Base.deliveries.first
    assert_not_nil delivered

    expected.message_id = '&lt;123@456&gt;'
    delivered.message_id = '&lt;123@456&gt;'

    assert_equal expected.encoded, delivered.encoded
  end

  def test_utf8_body_is_not_quoted
    @recipient = &quot;Foo áëô îü &lt;extended@example.net&gt;&quot;
    expected = new_mail &quot;UTF-8&quot;
    expected.to      = @recipient
    expected.subject = &quot;testing UTF-8 body&quot;
    expected.body    = &quot;åœö blah&quot;
    expected.from    = @recipient
    expected.cc      = @recipient
    expected.bcc     = @recipient
    expected.date    = Time.local 2004, 12, 12

    created = TestMailer.utf8_body @recipient
    assert_match(/åœö blah/, created.decoded)
  end

  def test_multiple_utf8_recipients
    @recipient = [&quot;\&quot;Foo áëô îü\&quot; &lt;extended@example.net&gt;&quot;, &quot;\&quot;Example Recipient\&quot; &lt;me@example.com&gt;&quot;]
    expected = new_mail &quot;UTF-8&quot;
    expected.to      = @recipient
    expected.subject = &quot;testing UTF-8 body&quot;
    expected.body    = &quot;åœö blah&quot;
    expected.from    = @recipient.first
    expected.cc      = @recipient
    expected.bcc     = @recipient
    expected.date    = Time.local 2004, 12, 12

    created = TestMailer.utf8_body @recipient
    from_regexp = Regexp.escape('From: Foo =?UTF-8?B?w6HDq8O0?= =?UTF-8?B?IMOuw7w=?=')
    assert_match(/#{from_regexp}/m, created.encoded)

    to_regexp   = Regexp.escape(&quot;To: =?UTF-8?B?Rm9vIMOhw6vDtCDDrsO8?= &lt;extended@example.net&gt;&quot;)
    assert_match(/#{to_regexp}/m, created.encoded)
  end

  def test_receive_decodes_base64_encoded_mail
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email&quot;)
    TestMailer.receive(fixture)
    assert_match(/Jamis/, TestMailer.received_body.to_s)
  end

  def test_receive_attachments
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email2&quot;)
    mail = Mail.new(fixture)
    attachment = mail.attachments.last
    assert_equal &quot;smime.p7s&quot;, attachment.filename
    assert_equal &quot;application/pkcs7-signature&quot;, mail.parts.last.mime_type
  end

  def test_decode_attachment_without_charset
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email3&quot;)
    mail = Mail.new(fixture)
    attachment = mail.attachments.last
    assert_equal 1026, attachment.read.length
  end

  def test_attachment_using_content_location
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email12&quot;)
    mail = Mail.new(fixture)
    assert_equal 1, mail.attachments.length
    assert_equal &quot;Photo25.jpg&quot;, mail.attachments.first.filename
  end

  def test_attachment_with_text_type
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email13&quot;)
    mail = Mail.new(fixture)
    assert mail.has_attachments?
    assert_equal 1, mail.attachments.length
    assert_equal &quot;hello.rb&quot;, mail.attachments.first.filename
  end

  def test_decode_part_without_content_type
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email4&quot;)
    mail = Mail.new(fixture)
    assert_nothing_raised { mail.body }
  end

  def test_decode_message_without_content_type
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email5&quot;)
    mail = Mail.new(fixture)
    assert_nothing_raised { mail.body }
  end

  def test_decode_message_with_incorrect_charset
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email6&quot;)
    mail = Mail.new(fixture)
    assert_nothing_raised { mail.body }
  end

  def test_multipart_with_mime_version
    mail = TestMailer.multipart_with_mime_version(@recipient)
    assert_equal &quot;1.1&quot;, mail.mime_version
  end

  def test_multipart_with_utf8_subject
    mail = TestMailer.multipart_with_utf8_subject(@recipient)
    regex = Regexp.escape('Subject: =?UTF-8?Q?Foo_=C3=A1=C3=AB=C3=B4_=C3=AE=C3=BC?=')
    assert_match(/#{regex}/, mail.encoded)
    string = &quot;Foo áëô îü&quot;
    assert_match(string, mail.subject)
  end

  def test_implicitly_multipart_with_utf8
    mail = TestMailer.implicitly_multipart_with_utf8
    regex = Regexp.escape('Subject: =?UTF-8?Q?Foo_=C3=A1=C3=AB=C3=B4_=C3=AE=C3=BC?=')
    assert_match(/#{regex}/, mail.encoded)
    string = &quot;Foo áëô îü&quot;
    assert_match(string, mail.subject)
  end

  def test_explicitly_multipart_messages
    mail = TestMailer.explicitly_multipart_example(@recipient)
    assert_equal 3, mail.parts.length
    assert_equal 'multipart/mixed', mail.mime_type
    assert_equal &quot;text/plain&quot;, mail.parts[0].mime_type

    assert_equal &quot;text/html&quot;, mail.parts[1].mime_type
    assert_equal &quot;iso-8859-1&quot;, mail.parts[1].charset

    assert_equal &quot;image/jpeg&quot;, mail.parts[2].mime_type

    assert_equal &quot;attachment&quot;, mail.parts[2][:content_disposition].disposition_type
    assert_equal &quot;foo.jpg&quot;, mail.parts[2][:content_disposition].filename
    assert_equal &quot;foo.jpg&quot;, mail.parts[2][:content_type].filename
    assert_nil mail.parts[2].charset
  end

  def test_explicitly_multipart_with_content_type
    mail = TestMailer.explicitly_multipart_example(@recipient, &quot;multipart/alternative&quot;)
    assert_equal 3, mail.parts.length
    assert_equal &quot;multipart/alternative&quot;, mail.mime_type
  end

  def test_explicitly_multipart_with_invalid_content_type
    mail = TestMailer.explicitly_multipart_example(@recipient, &quot;text/xml&quot;)
    assert_equal 3, mail.parts.length
    assert_equal 'multipart/mixed', mail.mime_type
  end

  def test_implicitly_multipart_messages
    assert ActionView::Template.template_handler_extensions.include?(&quot;bak&quot;), &quot;bak extension was not registered&quot;

    mail = TestMailer.implicitly_multipart_example(@recipient)
    assert_equal 3, mail.parts.length
    assert_equal &quot;1.0&quot;, mail.mime_version.to_s
    assert_equal &quot;multipart/alternative&quot;, mail.mime_type
    assert_equal &quot;text/plain&quot;, mail.parts[0].mime_type
    assert_equal &quot;UTF-8&quot;, mail.parts[0].charset
    assert_equal &quot;text/html&quot;, mail.parts[1].mime_type
    assert_equal &quot;UTF-8&quot;, mail.parts[1].charset
    assert_equal &quot;application/x-yaml&quot;, mail.parts[2].mime_type
    assert_equal &quot;UTF-8&quot;, mail.parts[2].charset
  end

  def test_implicitly_multipart_messages_with_custom_order
    assert ActionView::Template.template_handler_extensions.include?(&quot;bak&quot;), &quot;bak extension was not registered&quot;

    mail = TestMailer.implicitly_multipart_example(@recipient, nil, [&quot;application/x-yaml&quot;, &quot;text/plain&quot;])
    assert_equal 3, mail.parts.length
    assert_equal &quot;application/x-yaml&quot;, mail.parts[0].mime_type
    assert_equal &quot;text/plain&quot;, mail.parts[1].mime_type
    assert_equal &quot;text/html&quot;, mail.parts[2].mime_type
  end

  def test_implicitly_multipart_messages_with_charset
    mail = TestMailer.implicitly_multipart_example(@recipient, 'iso-8859-1')

    assert_equal &quot;multipart/alternative&quot;, mail.header['content-type'].content_type

    assert_equal 'iso-8859-1', mail.parts[0].content_type_parameters[:charset]
    assert_equal 'iso-8859-1', mail.parts[1].content_type_parameters[:charset]
    assert_equal 'iso-8859-1', mail.parts[2].content_type_parameters[:charset]
  end

  def test_html_mail
    mail = TestMailer.html_mail(@recipient)
    assert_equal &quot;text/html&quot;, mail.mime_type
  end

  def test_html_mail_with_underscores
    mail = TestMailer.html_mail_with_underscores(@recipient)
    assert_equal %{&lt;a href=&quot;http://google.com&quot; target=&quot;_blank&quot;&gt;_Google&lt;/a&gt;}, mail.body.to_s
  end

  def test_various_newlines
    mail = TestMailer.various_newlines(@recipient)
    assert_equal(&quot;line #1\nline #2\nline #3\nline #4\n\n&quot; +
                 &quot;line #5\n\nline#6\n\nline #7&quot;, mail.body.to_s)
  end

  def test_various_newlines_multipart
    mail = TestMailer.various_newlines_multipart(@recipient)
    assert_equal &quot;line #1\nline #2\nline #3\nline #4\n\n&quot;, mail.parts[0].body.to_s
    assert_equal &quot;&lt;p&gt;line #1&lt;/p&gt;\n&lt;p&gt;line #2&lt;/p&gt;\n&lt;p&gt;line #3&lt;/p&gt;\n&lt;p&gt;line #4&lt;/p&gt;\n\n&quot;, mail.parts[1].body.to_s
    assert_equal &quot;line #1\r\nline #2\r\nline #3\r\nline #4\r\n\r\n&quot;, mail.parts[0].body.encoded
    assert_equal &quot;&lt;p&gt;line #1&lt;/p&gt;\r\n&lt;p&gt;line #2&lt;/p&gt;\r\n&lt;p&gt;line #3&lt;/p&gt;\r\n&lt;p&gt;line #4&lt;/p&gt;\r\n\r\n&quot;, mail.parts[1].body.encoded
  end

  def test_headers_removed_on_smtp_delivery
    TestMailer.delivery_method = :smtp
    TestMailer.cc_bcc(@recipient).deliver
    assert MockSMTP.deliveries[0][2].include?(&quot;root@loudthinking.com&quot;)
    assert MockSMTP.deliveries[0][2].include?(&quot;nobody@loudthinking.com&quot;)
    assert MockSMTP.deliveries[0][2].include?(@recipient)
    assert_match %r{^Cc: nobody@loudthinking.com}, MockSMTP.deliveries[0][0]
    assert_match %r{^To: #{@recipient}}, MockSMTP.deliveries[0][0]
    assert_no_match %r{^Bcc: root@loudthinking.com}, MockSMTP.deliveries[0][0]
  end

   def test_file_delivery_should_create_a_file
     TestMailer.delivery_method = :file
     tmp_location = TestMailer.file_settings[:location]

     TestMailer.cc_bcc(@recipient).deliver
     assert File.exists?(tmp_location)
     assert File.directory?(tmp_location)
     assert File.exists?(File.join(tmp_location, @recipient))
     assert File.exists?(File.join(tmp_location, 'nobody@loudthinking.com'))
     assert File.exists?(File.join(tmp_location, 'root@loudthinking.com'))
   end

  def test_recursive_multipart_processing
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email7&quot;)
    mail = Mail.new(fixture)
    assert_equal(2, mail.parts.length)
    assert_equal(4, mail.parts.first.parts.length)
    assert_equal(&quot;This is the first part.&quot;, mail.parts.first.parts.first.body.to_s)
    assert_equal(&quot;test.rb&quot;, mail.parts.first.parts.second.filename)
    assert_equal(&quot;flowed&quot;, mail.parts.first.parts.fourth.content_type_parameters[:format])
    assert_equal('smime.p7s', mail.parts.second.filename)
  end

  def test_decode_encoded_attachment_filename
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email8&quot;)
    mail = Mail.new(fixture)
    attachment = mail.attachments.last

    expected = &quot;01 Quien Te Dij\212at. Pitbull.mp3&quot;

    if expected.respond_to?(:force_encoding)
      result = attachment.filename.dup
      expected.force_encoding(Encoding::ASCII_8BIT)
      result.force_encoding(Encoding::ASCII_8BIT)
      assert_equal expected, result
    else
      assert_equal expected, attachment.filename
    end
  end

  def test_decode_message_with_unknown_charset
    fixture = File.read(File.dirname(__FILE__) + &quot;/../fixtures/raw_email10&quot;)
    mail = Mail.new(fixture)
    assert_nothing_raised { mail.body }
  end

  def test_empty_header_values_omitted
    result = TestMailer.unnamed_attachment(@recipient).encoded
    assert_match %r{Content-Type: application/octet-stream}, result
    assert_match %r{Content-Disposition: attachment}, result
  end

  def test_headers_with_nonalpha_chars
    mail = TestMailer.headers_with_nonalpha_chars(@recipient)
    assert !mail.from_addrs.empty?
    assert !mail.cc_addrs.empty?
    assert !mail.bcc_addrs.empty?
    assert_match(/:/, mail[:from].decoded)
    assert_match(/:/, mail[:cc].decoded)
    assert_match(/:/, mail[:bcc].decoded)
  end

  def test_with_mail_object_deliver
    TestMailer.delivery_method = :test
    mail = TestMailer.headers_with_nonalpha_chars(@recipient)
    assert_nothing_raised { mail.deliver }
    assert_equal 1, TestMailer.deliveries.length
  end

  def test_multipart_with_template_path_with_dots
    mail = FunkyPathMailer.multipart_with_template_path_with_dots(@recipient)
    assert_equal 2, mail.parts.length
    assert_equal &quot;text/plain&quot;, mail.parts[0].mime_type
    assert_equal &quot;text/html&quot;, mail.parts[1].mime_type
    assert_equal &quot;UTF-8&quot;, mail.parts[1].charset
  end

  def test_custom_content_type_attributes
    mail = TestMailer.custom_content_type_attributes
    assert_match %r{format=flowed}, mail.content_type
    assert_match %r{charset=UTF-8}, mail.content_type
  end

  def test_return_path_with_create
    mail = TestMailer.return_path
    assert_equal &quot;another@somewhere.test&quot;, mail.return_path
  end

  def test_return_path_with_deliver
    TestMailer.delivery_method = :smtp
    TestMailer.return_path.deliver
    assert_match %r{^Return-Path: &lt;another@somewhere.test&gt;}, MockSMTP.deliveries[0][0]
    assert_equal &quot;another@somewhere.test&quot;, MockSMTP.deliveries[0][1].to_s
  end

  def test_starttls_is_enabled_if_supported
    TestMailer.smtp_settings.merge!(:enable_starttls_auto =&gt; true)
    MockSMTP.any_instance.expects(:respond_to?).with(:enable_starttls_auto).returns(true)
    MockSMTP.any_instance.expects(:enable_starttls_auto)
    TestMailer.delivery_method = :smtp
    TestMailer.signed_up(@recipient).deliver
  end

  def test_starttls_is_disabled_if_not_supported
    TestMailer.smtp_settings.merge!(:enable_starttls_auto =&gt; true)
    MockSMTP.any_instance.expects(:respond_to?).with(:enable_starttls_auto).returns(false)
    MockSMTP.any_instance.expects(:enable_starttls_auto).never
    TestMailer.delivery_method = :smtp
    TestMailer.signed_up(@recipient).deliver
  end

  def test_starttls_is_not_enabled
    TestMailer.smtp_settings.merge!(:enable_starttls_auto =&gt; false)
    MockSMTP.any_instance.expects(:respond_to?).never
    TestMailer.delivery_method = :smtp
    TestMailer.signed_up(@recipient).deliver
  ensure
    TestMailer.smtp_settings.merge!(:enable_starttls_auto =&gt; true)
  end
end
&quot;</span>
</pre>
              </div>
            </div>
            
          </div>
                    </div>
    </div>
  </body>
</html>    