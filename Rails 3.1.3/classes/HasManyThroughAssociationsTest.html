<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>HasManyThroughAssociationsTest</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            HasManyThroughAssociationsTest 
            
                <span class="parent">&lt; 
                    
                    ActiveRecord::TestCase
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/activerecord/test/cases/associations/has_many_through_associations_test_rb.html">activerecord/test/cases/associations/has_many_through_associations_test.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-setup">setup</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-test_add_two_instance_and_then_deleting">test_add_two_instance_and_then_deleting</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_existing">test_associate_existing</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_existing_record_twice_should_add_records_twice">test_associate_existing_record_twice_should_add_records_twice</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_existing_record_twice_should_add_to_target_twice">test_associate_existing_record_twice_should_add_to_target_twice</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_existing_with_nonstandard_primary_key_on_belongs_to">test_associate_existing_with_nonstandard_primary_key_on_belongs_to</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_new_by_building">test_associate_new_by_building</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_with_create">test_associate_with_create</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_with_create_and_invalid_options">test_associate_with_create_and_invalid_options</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_with_create_and_no_options">test_associate_with_create_and_no_options</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_with_create_and_valid_options">test_associate_with_create_and_valid_options</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_with_create_bang_and_invalid_options">test_associate_with_create_bang_and_invalid_options</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_with_create_bang_and_valid_options">test_associate_with_create_bang_and_valid_options</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_with_create_exclamation_and_no_options">test_associate_with_create_exclamation_and_no_options</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associate_with_create_with_through_having_conditions">test_associate_with_create_with_through_having_conditions</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_associating_new">test_associating_new</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_association_callback_ordering">test_association_callback_ordering</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_association_proxy_transaction_method_starts_transaction_in_association_class">test_association_proxy_transaction_method_starts_transaction_in_association_class</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_multiple_where_clauses">test_attributes_are_being_set_when_initialized_from_hm_through_association_with_multiple_where_clauses</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_where_clause">test_attributes_are_being_set_when_initialized_from_hm_through_association_with_where_clause</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_belongs_to_with_dependent_delete_all">test_belongs_to_with_dependent_delete_all</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_belongs_to_with_dependent_destroy">test_belongs_to_with_dependent_destroy</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_belongs_to_with_dependent_nullify">test_belongs_to_with_dependent_nullify</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_build_a_model_from_hm_through_association_with_where_clause">test_build_a_model_from_hm_through_association_with_where_clause</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_build_then_save_with_has_many_inverse">test_build_then_save_with_has_many_inverse</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_build_then_save_with_has_one_inverse">test_build_then_save_with_has_one_inverse</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_clear_associations">test_clear_associations</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_collection_build_with_nonstandard_primary_key_on_belongs_to">test_collection_build_with_nonstandard_primary_key_on_belongs_to</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_collection_create_with_nonstandard_primary_key_on_belongs_to">test_collection_create_with_nonstandard_primary_key_on_belongs_to</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_collection_delete_with_nonstandard_primary_key_on_belongs_to">test_collection_delete_with_nonstandard_primary_key_on_belongs_to</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_collection_singular_ids_getter_with_string_primary_keys">test_collection_singular_ids_getter_with_string_primary_keys</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_collection_singular_ids_setter">test_collection_singular_ids_setter</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_collection_singular_ids_setter_raises_exception_when_invalid_ids_set">test_collection_singular_ids_setter_raises_exception_when_invalid_ids_set</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_collection_singular_ids_setter_with_string_primary_keys">test_collection_singular_ids_setter_with_string_primary_keys</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_count_has_many_through_with_named_scope">test_count_has_many_through_with_named_scope</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_count_with_include_should_alias_join_table">test_count_with_include_should_alias_join_table</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_bang_returns_falsy_when_join_record_has_errors">test_create_bang_returns_falsy_when_join_record_has_errors</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_bang_should_raise_exception_when_join_record_has_errors">test_create_bang_should_raise_exception_when_join_record_has_errors</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_has_many_through_with_default_scope_on_join_model">test_create_has_many_through_with_default_scope_on_join_model</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_on_new_record">test_create_on_new_record</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_should_not_raise_exception_when_join_record_has_errors">test_create_should_not_raise_exception_when_join_record_has_errors</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_create_with_conditions_hash_on_through_association">test_create_with_conditions_hash_on_through_association</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_delete_association">test_delete_association</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_delete_through_belongs_to_with_dependent_delete_all">test_delete_through_belongs_to_with_dependent_delete_all</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_delete_through_belongs_to_with_dependent_destroy">test_delete_through_belongs_to_with_dependent_destroy</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_delete_through_belongs_to_with_dependent_nullify">test_delete_through_belongs_to_with_dependent_nullify</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_deleting_from_has_many_through_a_belongs_to_should_not_try_to_update_counter">test_deleting_from_has_many_through_a_belongs_to_should_not_try_to_update_counter</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_destroy_all">test_destroy_all</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_destroy_association">test_destroy_association</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_dynamic_find_should_respect_association_include">test_dynamic_find_should_respect_association_include</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_explicitly_joining_join_table">test_explicitly_joining_join_table</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_find_on_has_many_association_collection_with_include_and_conditions">test_find_on_has_many_association_collection_with_include_and_conditions</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_get_has_many_through_belongs_to_ids_with_conditions">test_get_has_many_through_belongs_to_ids_with_conditions</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_get_ids">test_get_ids</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_get_ids_for_loaded_associations">test_get_ids_for_loaded_associations</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_get_ids_for_unloaded_associations_does_not_load_them">test_get_ids_for_unloaded_associations_does_not_load_them</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_association_through_a_belongs_to_association">test_has_many_association_through_a_belongs_to_association</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist">test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_association_through_a_has_many_association_to_self">test_has_many_association_through_a_has_many_association_to_self</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys">test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_through_belongs_to_should_update_when_the_through_foreign_key_changes">test_has_many_through_belongs_to_should_update_when_the_through_foreign_key_changes</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_through_has_one_reflection">test_has_many_through_has_one_reflection</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_through_polymorphic_with_primary_key_option">test_has_many_through_polymorphic_with_primary_key_option</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_through_with_default_scope_on_join_model">test_has_many_through_with_default_scope_on_join_model</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_through_with_polymorphic_source">test_has_many_through_with_polymorphic_source</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_has_many_through_with_primary_key_option">test_has_many_through_with_primary_key_option</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_include-3F">test_include?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_build">test_include_method_in_association_through_should_return_true_for_instance_added_with_build</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_nested_builds">test_include_method_in_association_through_should_return_true_for_instance_added_with_nested_builds</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_inner_join_with_quoted_table_name">test_inner_join_with_quoted_table_name</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_interpolated_conditions">test_interpolated_conditions</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_joining_has_many_through_belongs_to">test_joining_has_many_through_belongs_to</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_joining_has_many_through_with_uniq">test_joining_has_many_through_with_uniq</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_modifying_has_many_through_has_one_reflection_should_raise">test_modifying_has_many_through_has_one_reflection_should_raise</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_preloading_empty_through_association_via_joins">test_preloading_empty_through_association_via_joins</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_primary_key_option_on_source">test_primary_key_option_on_source</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_push_with_invalid_join_record">test_push_with_invalid_join_record</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_push_with_invalid_record">test_push_with_invalid_record</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_replace_association">test_replace_association</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_replace_by_id_order_is_preserved">test_replace_by_id_order_is_preserved</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_replace_order_is_preserved">test_replace_order_is_preserved</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_save_bang_should_raise_exception_when_join_record_has_errors">test_save_bang_should_raise_exception_when_join_record_has_errors</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_save_should_not_raise_exception_when_join_record_has_errors">test_save_should_not_raise_exception_when_join_record_has_errors</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_select_chosen_fields_only">test_select_chosen_fields_only</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_should_raise_exception_for_destroying_mismatching_records">test_should_raise_exception_for_destroying_mismatching_records</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_size_of_through_association_should_increase_correctly_when_has_many_association_is_added">test_size_of_through_association_should_increase_correctly_when_has_many_association_is_added</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_update_counter_caches_on_delete">test_update_counter_caches_on_delete</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_update_counter_caches_on_delete_with_dependent_destroy">test_update_counter_caches_on_delete_with_dependent_destroy</a>,
              </li>
            
              
              <li>
                <a href="#method-i-test_update_counter_caches_on_delete_with_dependent_nullify">test_update_counter_caches_on_delete_with_dependent_nullify</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
        
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-setup">
            
              <a name="method-i-setup"></a><b>setup</b>()
            
          </div>
          
          
            <div class="description">
              <p>Dummies to force column loads so query counts are clean.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-setup_source')" id="l_method-i-setup_source">show</a>
                
              </p>
              <div id="method-i-setup_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 34</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">setup</span>
  <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create</span> <span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'gummy'</span>
  <span class="ruby-constant">Reader</span>.<span class="ruby-identifier">create</span> <span class="ruby-value">:person_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">0</span>, <span class="ruby-value">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">0</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_add_two_instance_and_then_deleting">
            
              <a name="method-i-test_add_two_instance_and_then_deleting"></a><b>test_add_two_instance_and_then_deleting</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_add_two_instance_and_then_deleting_source')" id="l_method-i-test_add_two_instance_and_then_deleting_source">show</a>
                
              </p>
              <div id="method-i-test_add_two_instance_and_then_deleting_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 80</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_add_two_instance_and_then_deleting</span>
  <span class="ruby-identifier">post</span>   = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>)
  <span class="ruby-identifier">person</span> = <span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>)

  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>
  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>

  <span class="ruby-identifier">counts</span> = [<span class="ruby-string">'post.people.count'</span>, <span class="ruby-string">'post.people.to_a.count'</span>, <span class="ruby-string">'post.readers.count'</span>, <span class="ruby-string">'post.readers.to_a.count'</span>]
  <span class="ruby-identifier">assert_difference</span> <span class="ruby-identifier">counts</span>, <span class="ruby-number">-2</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">person</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">person</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_existing">
            
              <a name="method-i-test_associate_existing"></a><b>test_associate_existing</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_existing_source')" id="l_method-i-test_associate_existing_source">show</a>
                
              </p>
              <div id="method-i-test_associate_existing_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 46</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_existing</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>); <span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>) <span class="ruby-comment"># Warm cache</span>

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>))
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_existing_record_twice_should_add_records_twice">
            
              <a name="method-i-test_associate_existing_record_twice_should_add_records_twice"></a><b>test_associate_existing_record_twice_should_add_records_twice</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_existing_record_twice_should_add_records_twice_source')" id="l_method-i-test_associate_existing_record_twice_should_add_records_twice_source">show</a>
                
              </p>
              <div id="method-i-test_associate_existing_record_twice_should_add_records_twice_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 70</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_existing_record_twice_should_add_records_twice</span>
  <span class="ruby-identifier">post</span>   = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>)
  <span class="ruby-identifier">person</span> = <span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>)

  <span class="ruby-identifier">assert_difference</span> <span class="ruby-string">'post.people.count'</span>, <span class="ruby-number">2</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>
    <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_existing_record_twice_should_add_to_target_twice">
            
              <a name="method-i-test_associate_existing_record_twice_should_add_to_target_twice"></a><b>test_associate_existing_record_twice_should_add_to_target_twice</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_existing_record_twice_should_add_to_target_twice_source')" id="l_method-i-test_associate_existing_record_twice_should_add_to_target_twice_source">show</a>
                
              </p>
              <div id="method-i-test_associate_existing_record_twice_should_add_to_target_twice_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_existing_record_twice_should_add_to_target_twice</span>
  <span class="ruby-identifier">post</span>   = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>)
  <span class="ruby-identifier">person</span> = <span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>)

  <span class="ruby-identifier">assert_difference</span> <span class="ruby-string">'post.people.to_a.count'</span>, <span class="ruby-number">2</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>
    <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">person</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_existing_with_nonstandard_primary_key_on_belongs_to">
            
              <a name="method-i-test_associate_existing_with_nonstandard_primary_key_on_belongs_to"></a><b>test_associate_existing_with_nonstandard_primary_key_on_belongs_to</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_existing_with_nonstandard_primary_key_on_belongs_to_source')" id="l_method-i-test_associate_existing_with_nonstandard_primary_key_on_belongs_to_source">show</a>
                
              </p>
              <div id="method-i-test_associate_existing_with_nonstandard_primary_key_on_belongs_to_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 596</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_existing_with_nonstandard_primary_key_on_belongs_to</span>
  <span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:author</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>), <span class="ruby-value">:named_category_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">categories</span>(<span class="ruby-value">:general</span>).<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">categories</span>(<span class="ruby-value">:general</span>), <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>).<span class="ruby-identifier">named_categories</span>.<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_new_by_building">
            
              <a name="method-i-test_associate_new_by_building"></a><b>test_associate_new_by_building</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_new_by_building_source')" id="l_method-i-test_associate_new_by_building_source">show</a>
                
              </p>
              <div id="method-i-test_associate_new_by_building_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 116</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_new_by_building</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>) }

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">0</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">build</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Bob&quot;</span>)
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Ted&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Should only need to load the association once</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;Bob&quot;</span>)
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;Ted&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># 2 queries for each new record (1 to save the record itself, 1 for the join model)</span>
  <span class="ruby-comment">#    * 2 new records = 4</span>
  <span class="ruby-comment"># + 1 query to save the actual post = 5</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">5</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-string">'-changed'</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;Bob&quot;</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;Ted&quot;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_with_create">
            
              <a name="method-i-test_associate_with_create"></a><b>test_associate_with_create</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_with_create_source')" id="l_method-i-test_associate_with_create_source">show</a>
                
              </p>
              <div id="method-i-test_associate_with_create_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 373</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_with_create</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>) }

  <span class="ruby-comment"># 1 query for the new record, 1 for the join table record</span>
  <span class="ruby-comment"># No need to update the actual collection yet!</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">2</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:first_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;Jeb&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># *Now* we actually need the collection so it's loaded</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;Jeb&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-string">&quot;Jeb&quot;</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_with_create_and_invalid_options">
            
              <a name="method-i-test_associate_with_create_and_invalid_options"></a><b>test_associate_with_create_and_invalid_options</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_with_create_and_invalid_options_source')" id="l_method-i-test_associate_with_create_and_invalid_options_source">show</a>
                
              </p>
              <div id="method-i-test_associate_with_create_and_invalid_options_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 415</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_with_create_and_invalid_options</span>
  <span class="ruby-identifier">firm</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-value">:first_firm</span>)
  <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-string">'firm.developers.count'</span>) { <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'0'</span>) } }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_with_create_and_no_options">
            
              <a name="method-i-test_associate_with_create_and_no_options"></a><b>test_associate_with_create_and_no_options</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_with_create_and_no_options_source')" id="l_method-i-test_associate_with_create_and_no_options_source">show</a>
                
              </p>
              <div id="method-i-test_associate_with_create_and_no_options_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 390</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_with_create_and_no_options</span>
  <span class="ruby-identifier">peeps</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'foo'</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">peeps</span> <span class="ruby-operator">+</span> <span class="ruby-number">1</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_with_create_and_valid_options">
            
              <a name="method-i-test_associate_with_create_and_valid_options"></a><b>test_associate_with_create_and_valid_options</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_with_create_and_valid_options_source')" id="l_method-i-test_associate_with_create_and_valid_options_source">show</a>
                
              </p>
              <div id="method-i-test_associate_with_create_and_valid_options_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 420</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_with_create_and_valid_options</span>
  <span class="ruby-identifier">firm</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-value">:first_firm</span>)
  <span class="ruby-identifier">assert_difference</span>(<span class="ruby-string">'firm.developers.count'</span>, <span class="ruby-number">1</span>) { <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'developer'</span>) }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_with_create_bang_and_invalid_options">
            
              <a name="method-i-test_associate_with_create_bang_and_invalid_options"></a><b>test_associate_with_create_bang_and_invalid_options</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_with_create_bang_and_invalid_options_source')" id="l_method-i-test_associate_with_create_bang_and_invalid_options_source">show</a>
                
              </p>
              <div id="method-i-test_associate_with_create_bang_and_invalid_options_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 425</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_with_create_bang_and_invalid_options</span>
  <span class="ruby-identifier">firm</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-value">:first_firm</span>)
  <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-string">'firm.developers.count'</span>) { <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>) { <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'0'</span>) } }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_with_create_bang_and_valid_options">
            
              <a name="method-i-test_associate_with_create_bang_and_valid_options"></a><b>test_associate_with_create_bang_and_valid_options</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_with_create_bang_and_valid_options_source')" id="l_method-i-test_associate_with_create_bang_and_valid_options_source">show</a>
                
              </p>
              <div id="method-i-test_associate_with_create_bang_and_valid_options_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 430</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_with_create_bang_and_valid_options</span>
  <span class="ruby-identifier">firm</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-value">:first_firm</span>)
  <span class="ruby-identifier">assert_difference</span>(<span class="ruby-string">'firm.developers.count'</span>, <span class="ruby-number">1</span>) { <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'developer'</span>) }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_with_create_exclamation_and_no_options">
            
              <a name="method-i-test_associate_with_create_exclamation_and_no_options"></a><b>test_associate_with_create_exclamation_and_no_options</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_with_create_exclamation_and_no_options_source')" id="l_method-i-test_associate_with_create_exclamation_and_no_options_source">show</a>
                
              </p>
              <div id="method-i-test_associate_with_create_exclamation_and_no_options_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 402</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_with_create_exclamation_and_no_options</span>
  <span class="ruby-identifier">peeps</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'foo'</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">peeps</span> <span class="ruby-operator">+</span> <span class="ruby-number">1</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associate_with_create_with_through_having_conditions">
            
              <a name="method-i-test_associate_with_create_with_through_having_conditions"></a><b>test_associate_with_create_with_through_having_conditions</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associate_with_create_with_through_having_conditions_source')" id="l_method-i-test_associate_with_create_with_through_having_conditions_source">show</a>
                
              </p>
              <div id="method-i-test_associate_with_create_with_through_having_conditions_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 396</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associate_with_create_with_through_having_conditions</span>
  <span class="ruby-identifier">impatient_people</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">impatient_people</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">impatient_people</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'foo'</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">impatient_people</span> <span class="ruby-operator">+</span> <span class="ruby-number">1</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">impatient_people</span>.<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_associating_new">
            
              <a name="method-i-test_associating_new"></a><b>test_associating_new</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_associating_new_source')" id="l_method-i-test_associating_new_source">show</a>
                
              </p>
              <div id="method-i-test_associating_new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_associating_new</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>) }
  <span class="ruby-identifier">new_person</span> = <span class="ruby-keyword">nil</span> <span class="ruby-comment"># so block binding catches it</span>

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">0</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">new_person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span> <span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'bob'</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Associating new records always saves them</span>
  <span class="ruby-comment"># Thus, 1 query for the new person record, 1 query for the new join table record</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">2</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_person</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">new_person</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">new_person</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_association_callback_ordering">
            
              <a name="method-i-test_association_callback_ordering"></a><b>test_association_callback_ordering</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_association_callback_ordering_source')" id="l_method-i-test_association_callback_ordering_source">show</a>
                
              </p>
              <div id="method-i-test_association_callback_ordering_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 467</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_association_callback_ordering</span>
  <span class="ruby-constant">Post</span>.<span class="ruby-identifier">reset_log</span>
  <span class="ruby-identifier">log</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">log</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>)

  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>)
  <span class="ruby-identifier">assert_equal</span> [
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:before</span>, <span class="ruby-string">&quot;Michael&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:after</span>, <span class="ruby-string">&quot;Michael&quot;</span>]
  ], <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-number">2</span>)

  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>), <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Bob&quot;</span>), <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Lary&quot;</span>))
  <span class="ruby-identifier">assert_equal</span> [
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:before</span>, <span class="ruby-string">&quot;David&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:after</span>, <span class="ruby-string">&quot;David&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:before</span>, <span class="ruby-string">&quot;Bob&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:after</span>, <span class="ruby-string">&quot;Bob&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:before</span>, <span class="ruby-string">&quot;Lary&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:after</span>, <span class="ruby-string">&quot;Lary&quot;</span>]
  ],<span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-number">6</span>)

  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span>.<span class="ruby-identifier">build</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Ted&quot;</span>)
  <span class="ruby-identifier">assert_equal</span> [
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:before</span>, <span class="ruby-string">&quot;Ted&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:after</span>, <span class="ruby-string">&quot;Ted&quot;</span>]
  ], <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-number">2</span>)

  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Sam&quot;</span>)
  <span class="ruby-identifier">assert_equal</span> [
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:before</span>, <span class="ruby-string">&quot;Sam&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:after</span>, <span class="ruby-string">&quot;Sam&quot;</span>]
  ], <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-number">2</span>)

  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>),<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>), <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Julian&quot;</span>), <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Roger&quot;</span>)]
  <span class="ruby-identifier">assert_equal</span>((<span class="ruby-node">%w(Ted Bob Sam Lary)</span> * <span class="ruby-number">2</span>).<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">log</span>[<span class="ruby-number">-12</span><span class="ruby-operator">..</span><span class="ruby-number">-5</span>].<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:last</span>).<span class="ruby-identifier">sort</span>)
  <span class="ruby-identifier">assert_equal</span> [
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:before</span>, <span class="ruby-string">&quot;Julian&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:after</span>, <span class="ruby-string">&quot;Julian&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:before</span>, <span class="ruby-string">&quot;Roger&quot;</span>],
    [<span class="ruby-value">:added</span>, <span class="ruby-value">:after</span>, <span class="ruby-string">&quot;Roger&quot;</span>]
  ], <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-number">4</span>)

  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">assert_equal</span>((<span class="ruby-node">%w(Michael David Julian Roger)</span> * <span class="ruby-number">2</span>).<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-number">8</span>).<span class="ruby-identifier">collect</span>(&amp;<span class="ruby-value">:last</span>).<span class="ruby-identifier">sort</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_association_proxy_transaction_method_starts_transaction_in_association_class">
            
              <a name="method-i-test_association_proxy_transaction_method_starts_transaction_in_association_class"></a><b>test_association_proxy_transaction_method_starts_transaction_in_association_class</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_association_proxy_transaction_method_starts_transaction_in_association_class_source')" id="l_method-i-test_association_proxy_transaction_method_starts_transaction_in_association_class_source">show</a>
                
              </p>
              <div id="method-i-test_association_proxy_transaction_method_starts_transaction_in_association_class_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 547</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_association_proxy_transaction_method_starts_transaction_in_association_class</span>
  <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-value">:transaction</span>)
  <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:first</span>).<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># nothing</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_multiple_where_clauses">
            
              <a name="method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_multiple_where_clauses"></a><b>test_attributes_are_being_set_when_initialized_from_hm_through_association_with_multiple_where_clauses</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_multiple_where_clauses_source')" id="l_method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_multiple_where_clauses_source">show</a>
                
              </p>
              <div id="method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_multiple_where_clauses_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 665</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_attributes_are_being_set_when_initialized_from_hm_through_association_with_multiple_where_clauses</span>
  <span class="ruby-identifier">new_subscriber</span> = <span class="ruby-identifier">books</span>(<span class="ruby-value">:awdr</span>).<span class="ruby-identifier">subscribers</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:nick</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;marklazz&quot;</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Marcelo Giorgi'</span>).<span class="ruby-identifier">build</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">new_subscriber</span>.<span class="ruby-identifier">nick</span>, <span class="ruby-string">&quot;marklazz&quot;</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">new_subscriber</span>.<span class="ruby-identifier">name</span>, <span class="ruby-string">&quot;Marcelo Giorgi&quot;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_where_clause">
            
              <a name="method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_where_clause"></a><b>test_attributes_are_being_set_when_initialized_from_hm_through_association_with_where_clause</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_where_clause_source')" id="l_method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_where_clause_source">show</a>
                
              </p>
              <div id="method-i-test_attributes_are_being_set_when_initialized_from_hm_through_association_with_where_clause_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 660</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_attributes_are_being_set_when_initialized_from_hm_through_association_with_where_clause</span>
  <span class="ruby-identifier">new_subscriber</span> = <span class="ruby-identifier">books</span>(<span class="ruby-value">:awdr</span>).<span class="ruby-identifier">subscribers</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:nick</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;marklazz&quot;</span>).<span class="ruby-identifier">build</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">new_subscriber</span>.<span class="ruby-identifier">nick</span>, <span class="ruby-string">&quot;marklazz&quot;</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_belongs_to_with_dependent_delete_all">
            
              <a name="method-i-test_belongs_to_with_dependent_delete_all"></a><b>test_belongs_to_with_dependent_delete_all</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_belongs_to_with_dependent_delete_all_source')" id="l_method-i-test_belongs_to_with_dependent_delete_all_source">show</a>
                
              </p>
              <div id="method-i-test_belongs_to_with_dependent_delete_all_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 275</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_belongs_to_with_dependent_delete_all</span>
  <span class="ruby-identifier">person</span> = <span class="ruby-constant">PersonWithDependentDeleteAllJobs</span>.<span class="ruby-identifier">find</span>(<span class="ruby-number">1</span>)

  <span class="ruby-comment"># Create a reference which is not linked to a job. This should not be destroyed.</span>
  <span class="ruby-identifier">person</span>.<span class="ruby-identifier">references</span>.<span class="ruby-identifier">create!</span>

  <span class="ruby-identifier">assert_no_difference</span> <span class="ruby-string">'Job.count'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span> <span class="ruby-string">'Reference.count'</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">person</span>.<span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">count</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">person</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_belongs_to_with_dependent_destroy">
            
              <a name="method-i-test_belongs_to_with_dependent_destroy"></a><b>test_belongs_to_with_dependent_destroy</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_belongs_to_with_dependent_destroy_source')" id="l_method-i-test_belongs_to_with_dependent_destroy_source">show</a>
                
              </p>
              <div id="method-i-test_belongs_to_with_dependent_destroy_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 262</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_belongs_to_with_dependent_destroy</span>
  <span class="ruby-identifier">person</span> = <span class="ruby-constant">PersonWithDependentDestroyJobs</span>.<span class="ruby-identifier">find</span>(<span class="ruby-number">1</span>)

  <span class="ruby-comment"># Create a reference which is not linked to a job. This should not be destroyed.</span>
  <span class="ruby-identifier">person</span>.<span class="ruby-identifier">references</span>.<span class="ruby-identifier">create!</span>

  <span class="ruby-identifier">assert_no_difference</span> <span class="ruby-string">'Job.count'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span> <span class="ruby-string">'Reference.count'</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">person</span>.<span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">count</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">person</span>.<span class="ruby-identifier">destroy</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_belongs_to_with_dependent_nullify">
            
              <a name="method-i-test_belongs_to_with_dependent_nullify"></a><b>test_belongs_to_with_dependent_nullify</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_belongs_to_with_dependent_nullify_source')" id="l_method-i-test_belongs_to_with_dependent_nullify_source">show</a>
                
              </p>
              <div id="method-i-test_belongs_to_with_dependent_nullify_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 288</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_belongs_to_with_dependent_nullify</span>
  <span class="ruby-identifier">person</span> = <span class="ruby-constant">PersonWithDependentNullifyJobs</span>.<span class="ruby-identifier">find</span>(<span class="ruby-number">1</span>)

  <span class="ruby-identifier">references</span> = <span class="ruby-identifier">person</span>.<span class="ruby-identifier">references</span>.<span class="ruby-identifier">to_a</span>

  <span class="ruby-identifier">assert_no_difference</span> [<span class="ruby-string">'Reference.count'</span>, <span class="ruby-string">'Job.count'</span>] <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">person</span>.<span class="ruby-identifier">destroy</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">references</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">reference</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">reference</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">job_id</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_build_a_model_from_hm_through_association_with_where_clause">
            
              <a name="method-i-test_build_a_model_from_hm_through_association_with_where_clause"></a><b>test_build_a_model_from_hm_through_association_with_where_clause</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_build_a_model_from_hm_through_association_with_where_clause_source')" id="l_method-i-test_build_a_model_from_hm_through_association_with_where_clause_source">show</a>
                
              </p>
              <div id="method-i-test_build_a_model_from_hm_through_association_with_where_clause_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 656</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_build_a_model_from_hm_through_association_with_where_clause</span>
  <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">books</span>(<span class="ruby-value">:awdr</span>).<span class="ruby-identifier">subscribers</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:nick</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;marklazz&quot;</span>).<span class="ruby-identifier">build</span> }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_build_then_save_with_has_many_inverse">
            
              <a name="method-i-test_build_then_save_with_has_many_inverse"></a><b>test_build_then_save_with_has_many_inverse</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_build_then_save_with_has_many_inverse_source')" id="l_method-i-test_build_then_save_with_has_many_inverse_source">show</a>
                
              </p>
              <div id="method-i-test_build_then_save_with_has_many_inverse_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 142</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_build_then_save_with_has_many_inverse</span>
  <span class="ruby-identifier">post</span>   = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>)
  <span class="ruby-identifier">person</span> = <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">build</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Bob&quot;</span>)
  <span class="ruby-identifier">person</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">reload</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">person</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_build_then_save_with_has_one_inverse">
            
              <a name="method-i-test_build_then_save_with_has_one_inverse"></a><b>test_build_then_save_with_has_one_inverse</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_build_then_save_with_has_one_inverse_source')" id="l_method-i-test_build_then_save_with_has_one_inverse_source">show</a>
                
              </p>
              <div id="method-i-test_build_then_save_with_has_one_inverse_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 151</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_build_then_save_with_has_one_inverse</span>
  <span class="ruby-identifier">post</span>   = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>)
  <span class="ruby-identifier">person</span> = <span class="ruby-identifier">post</span>.<span class="ruby-identifier">single_people</span>.<span class="ruby-identifier">build</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Bob&quot;</span>)
  <span class="ruby-identifier">person</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">reload</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">single_people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">person</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_clear_associations">
            
              <a name="method-i-test_clear_associations"></a><b>test_clear_associations</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_clear_associations_source')" id="l_method-i-test_clear_associations_source">show</a>
                
              </p>
              <div id="method-i-test_clear_associations_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 453</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_clear_associations</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">2</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>);<span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>) }

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">0</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_collection_build_with_nonstandard_primary_key_on_belongs_to">
            
              <a name="method-i-test_collection_build_with_nonstandard_primary_key_on_belongs_to"></a><b>test_collection_build_with_nonstandard_primary_key_on_belongs_to</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_collection_build_with_nonstandard_primary_key_on_belongs_to_source')" id="l_method-i-test_collection_build_with_nonstandard_primary_key_on_belongs_to_source">show</a>
                
              </p>
              <div id="method-i-test_collection_build_with_nonstandard_primary_key_on_belongs_to_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 601</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_collection_build_with_nonstandard_primary_key_on_belongs_to</span>
  <span class="ruby-identifier">author</span>   = <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>)
  <span class="ruby-identifier">category</span> = <span class="ruby-identifier">author</span>.<span class="ruby-identifier">named_categories</span>.<span class="ruby-identifier">build</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Primary&quot;</span>)
  <span class="ruby-identifier">author</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-value">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:named_category_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">category</span>.<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">named_categories</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">category</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_collection_create_with_nonstandard_primary_key_on_belongs_to">
            
              <a name="method-i-test_collection_create_with_nonstandard_primary_key_on_belongs_to"></a><b>test_collection_create_with_nonstandard_primary_key_on_belongs_to</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_collection_create_with_nonstandard_primary_key_on_belongs_to_source')" id="l_method-i-test_collection_create_with_nonstandard_primary_key_on_belongs_to_source">show</a>
                
              </p>
              <div id="method-i-test_collection_create_with_nonstandard_primary_key_on_belongs_to_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 609</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_collection_create_with_nonstandard_primary_key_on_belongs_to</span>
  <span class="ruby-identifier">author</span>   = <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>)
  <span class="ruby-identifier">category</span> = <span class="ruby-identifier">author</span>.<span class="ruby-identifier">named_categories</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Primary&quot;</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-value">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:named_category_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">category</span>.<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">named_categories</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">category</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_collection_delete_with_nonstandard_primary_key_on_belongs_to">
            
              <a name="method-i-test_collection_delete_with_nonstandard_primary_key_on_belongs_to"></a><b>test_collection_delete_with_nonstandard_primary_key_on_belongs_to</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_collection_delete_with_nonstandard_primary_key_on_belongs_to_source')" id="l_method-i-test_collection_delete_with_nonstandard_primary_key_on_belongs_to_source">show</a>
                
              </p>
              <div id="method-i-test_collection_delete_with_nonstandard_primary_key_on_belongs_to_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 616</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_collection_delete_with_nonstandard_primary_key_on_belongs_to</span>
  <span class="ruby-identifier">author</span>   = <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>)
  <span class="ruby-identifier">category</span> = <span class="ruby-identifier">author</span>.<span class="ruby-identifier">named_categories</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Primary&quot;</span>)
  <span class="ruby-identifier">author</span>.<span class="ruby-identifier">named_categories</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">category</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-value">:author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:named_category_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">category</span>.<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">named_categories</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_collection_singular_ids_getter_with_string_primary_keys">
            
              <a name="method-i-test_collection_singular_ids_getter_with_string_primary_keys"></a><b>test_collection_singular_ids_getter_with_string_primary_keys</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_collection_singular_ids_getter_with_string_primary_keys_source')" id="l_method-i-test_collection_singular_ids_getter_with_string_primary_keys_source">show</a>
                
              </p>
              <div id="method-i-test_collection_singular_ids_getter_with_string_primary_keys_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 624</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_collection_singular_ids_getter_with_string_primary_keys</span>
  <span class="ruby-identifier">book</span> = <span class="ruby-identifier">books</span>(<span class="ruby-value">:awdr</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">2</span>, <span class="ruby-identifier">book</span>.<span class="ruby-identifier">subscriber_ids</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">subscribers</span>(<span class="ruby-value">:first</span>).<span class="ruby-identifier">nick</span>, <span class="ruby-identifier">subscribers</span>(<span class="ruby-value">:second</span>).<span class="ruby-identifier">nick</span>].<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">book</span>.<span class="ruby-identifier">subscriber_ids</span>.<span class="ruby-identifier">sort</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_collection_singular_ids_setter">
            
              <a name="method-i-test_collection_singular_ids_setter"></a><b>test_collection_singular_ids_setter</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_collection_singular_ids_setter_source')" id="l_method-i-test_collection_singular_ids_setter_source">show</a>
                
              </p>
              <div id="method-i-test_collection_singular_ids_setter_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 630</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_collection_singular_ids_setter</span>
  <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-value">:rails_core</span>)
  <span class="ruby-identifier">dev</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:first</span>)

  <span class="ruby-identifier">company</span>.<span class="ruby-identifier">developer_ids</span> = [<span class="ruby-identifier">dev</span>.<span class="ruby-identifier">id</span>]
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">dev</span>], <span class="ruby-identifier">company</span>.<span class="ruby-identifier">developers</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_collection_singular_ids_setter_raises_exception_when_invalid_ids_set">
            
              <a name="method-i-test_collection_singular_ids_setter_raises_exception_when_invalid_ids_set"></a><b>test_collection_singular_ids_setter_raises_exception_when_invalid_ids_set</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_collection_singular_ids_setter_raises_exception_when_invalid_ids_set_source')" id="l_method-i-test_collection_singular_ids_setter_raises_exception_when_invalid_ids_set_source">show</a>
                
              </p>
              <div id="method-i-test_collection_singular_ids_setter_raises_exception_when_invalid_ids_set_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 650</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_collection_singular_ids_setter_raises_exception_when_invalid_ids_set</span>
  <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-value">:rails_core</span>)
  <span class="ruby-identifier">ids</span> =  [<span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">:first</span>).<span class="ruby-identifier">id</span>, <span class="ruby-number">-9999</span>]
  <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotFound</span>) {<span class="ruby-identifier">company</span>.<span class="ruby-identifier">developer_ids</span>= <span class="ruby-identifier">ids</span>}
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_collection_singular_ids_setter_with_string_primary_keys">
            
              <a name="method-i-test_collection_singular_ids_setter_with_string_primary_keys"></a><b>test_collection_singular_ids_setter_with_string_primary_keys</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_collection_singular_ids_setter_with_string_primary_keys_source')" id="l_method-i-test_collection_singular_ids_setter_with_string_primary_keys_source">show</a>
                
              </p>
              <div id="method-i-test_collection_singular_ids_setter_with_string_primary_keys_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 638</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_collection_singular_ids_setter_with_string_primary_keys</span>
  <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">book</span> = <span class="ruby-identifier">books</span>(<span class="ruby-value">:awdr</span>)
    <span class="ruby-identifier">book</span>.<span class="ruby-identifier">subscriber_ids</span> = [<span class="ruby-identifier">subscribers</span>(<span class="ruby-value">:second</span>).<span class="ruby-identifier">nick</span>]
    <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">subscribers</span>(<span class="ruby-value">:second</span>)], <span class="ruby-identifier">book</span>.<span class="ruby-identifier">subscribers</span>(<span class="ruby-keyword">true</span>)

    <span class="ruby-identifier">book</span>.<span class="ruby-identifier">subscriber_ids</span> = []
    <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-identifier">book</span>.<span class="ruby-identifier">subscribers</span>(<span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_count_has_many_through_with_named_scope">
            
              <a name="method-i-test_count_has_many_through_with_named_scope"></a><b>test_count_has_many_through_with_named_scope</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_count_has_many_through_with_named_scope_source')" id="l_method-i-test_count_has_many_through_with_named_scope_source">show</a>
                
              </p>
              <div id="method-i-test_count_has_many_through_with_named_scope_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 742</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_count_has_many_through_with_named_scope</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">2</span>, <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>).<span class="ruby-identifier">categories</span>.<span class="ruby-identifier">count</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">1</span>, <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>).<span class="ruby-identifier">categories</span>.<span class="ruby-identifier">general</span>.<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_count_with_include_should_alias_join_table">
            
              <a name="method-i-test_count_with_include_should_alias_join_table"></a><b>test_count_with_include_should_alias_join_table</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_count_with_include_should_alias_join_table_source')" id="l_method-i-test_count_with_include_should_alias_join_table_source">show</a>
                
              </p>
              <div id="method-i-test_count_with_include_should_alias_join_table_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 519</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_count_with_include_should_alias_join_table</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">2</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">count</span>(<span class="ruby-value">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">:readers</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_bang_returns_falsy_when_join_record_has_errors">
            
              <a name="method-i-test_create_bang_returns_falsy_when_join_record_has_errors"></a><b>test_create_bang_returns_falsy_when_join_record_has_errors</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_bang_returns_falsy_when_join_record_has_errors_source')" id="l_method-i-test_create_bang_returns_falsy_when_join_record_has_errors_source">show</a>
                
              </p>
              <div id="method-i-test_create_bang_returns_falsy_when_join_record_has_errors_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 829</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_bang_returns_falsy_when_join_record_has_errors</span>
  <span class="ruby-identifier">repair_validations</span>(<span class="ruby-constant">Categorization</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">validate</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>[<span class="ruby-value">:base</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'Invalid Categorization'</span> }
    <span class="ruby-identifier">c</span> = <span class="ruby-constant">Category</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Fishing'</span>, <span class="ruby-value">:authors</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-constant">Author</span>.<span class="ruby-identifier">first</span>])
    <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_bang_should_raise_exception_when_join_record_has_errors">
            
              <a name="method-i-test_create_bang_should_raise_exception_when_join_record_has_errors"></a><b>test_create_bang_should_raise_exception_when_join_record_has_errors</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_bang_should_raise_exception_when_join_record_has_errors_source')" id="l_method-i-test_create_bang_should_raise_exception_when_join_record_has_errors_source">show</a>
                
              </p>
              <div id="method-i-test_create_bang_should_raise_exception_when_join_record_has_errors_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 810</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_bang_should_raise_exception_when_join_record_has_errors</span>
  <span class="ruby-identifier">repair_validations</span>(<span class="ruby-constant">Categorization</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">validate</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>[<span class="ruby-value">:base</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'Invalid Categorization'</span> }
    <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-constant">Category</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Fishing'</span>, <span class="ruby-value">:authors</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-constant">Author</span>.<span class="ruby-identifier">first</span>])
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_has_many_through_with_default_scope_on_join_model">
            
              <a name="method-i-test_create_has_many_through_with_default_scope_on_join_model"></a><b>test_create_has_many_through_with_default_scope_on_join_model</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_has_many_through_with_default_scope_on_join_model_source')" id="l_method-i-test_create_has_many_through_with_default_scope_on_join_model_source">show</a>
                
              </p>
              <div id="method-i-test_create_has_many_through_with_default_scope_on_join_model_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 715</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_has_many_through_with_default_scope_on_join_model</span>
  <span class="ruby-identifier">category</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">special_categories</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Foo&quot;</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">1</span>, <span class="ruby-identifier">category</span>.<span class="ruby-identifier">categorizations</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:special</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_on_new_record">
            
              <a name="method-i-test_create_on_new_record"></a><b>test_create_on_new_record</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_on_new_record_source')" id="l_method-i-test_create_on_new_record_source">show</a>
                
              </p>
              <div id="method-i-test_create_on_new_record_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 408</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_on_new_record</span>
  <span class="ruby-identifier">p</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotSaved</span>) { <span class="ruby-identifier">p</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;mew&quot;</span>) }
  <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotSaved</span>) { <span class="ruby-identifier">p</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;snow&quot;</span>) }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_should_not_raise_exception_when_join_record_has_errors">
            
              <a name="method-i-test_create_should_not_raise_exception_when_join_record_has_errors"></a><b>test_create_should_not_raise_exception_when_join_record_has_errors</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_should_not_raise_exception_when_join_record_has_errors_source')" id="l_method-i-test_create_should_not_raise_exception_when_join_record_has_errors_source">show</a>
                
              </p>
              <div id="method-i-test_create_should_not_raise_exception_when_join_record_has_errors_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 795</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_should_not_raise_exception_when_join_record_has_errors</span>
  <span class="ruby-identifier">repair_validations</span>(<span class="ruby-constant">Categorization</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">validate</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>[<span class="ruby-value">:base</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'Invalid Categorization'</span> }
    <span class="ruby-constant">Category</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Fishing'</span>, <span class="ruby-value">:authors</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-constant">Author</span>.<span class="ruby-identifier">first</span>])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_create_with_conditions_hash_on_through_association">
            
              <a name="method-i-test_create_with_conditions_hash_on_through_association"></a><b>test_create_with_conditions_hash_on_through_association</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_create_with_conditions_hash_on_through_association_source')" id="l_method-i-test_create_with_conditions_hash_on_through_association_source">show</a>
                
              </p>
              <div id="method-i-test_create_with_conditions_hash_on_through_association_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 762</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_create_with_conditions_hash_on_through_association</span>
  <span class="ruby-identifier">member</span> = <span class="ruby-identifier">members</span>(<span class="ruby-value">:groucho</span>)
  <span class="ruby-identifier">club</span>   = <span class="ruby-identifier">member</span>.<span class="ruby-identifier">clubs</span>.<span class="ruby-identifier">create!</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">true</span>, <span class="ruby-identifier">club</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">membership</span>.<span class="ruby-identifier">favourite</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_delete_association">
            
              <a name="method-i-test_delete_association"></a><b>test_delete_association</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_delete_association_source')" id="l_method-i-test_delete_association_source">show</a>
                
              </p>
              <div id="method-i-test_delete_association_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 160</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_delete_association</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">2</span>){<span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>);<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>); }

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">1</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_delete_through_belongs_to_with_dependent_delete_all">
            
              <a name="method-i-test_delete_through_belongs_to_with_dependent_delete_all"></a><b>test_delete_through_belongs_to_with_dependent_delete_all</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_delete_through_belongs_to_with_dependent_delete_all_source')" id="l_method-i-test_delete_through_belongs_to_with_dependent_delete_all_source">show</a>
                
              </p>
              <div id="method-i-test_delete_through_belongs_to_with_dependent_delete_all_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 220</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_delete_through_belongs_to_with_dependent_delete_all</span>
  <span class="ruby-constant">Reference</span>.<span class="ruby-identifier">make_comments</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">person</span> = <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>)
  <span class="ruby-identifier">job</span>    = <span class="ruby-identifier">jobs</span>(<span class="ruby-value">:magician</span>)

  <span class="ruby-comment"># Make sure we're not deleting everything</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-number">2</span>

  <span class="ruby-identifier">assert_no_difference</span> <span class="ruby-string">'Job.count'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span> [<span class="ruby-string">'person.jobs.count'</span>, <span class="ruby-string">'Reference.count'</span>], <span class="ruby-number">-1</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">person</span>.<span class="ruby-identifier">jobs_with_dependent_delete_all</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">job</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Check that the destroy callback on Reference did not run</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">person</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">comments</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-constant">Reference</span>.<span class="ruby-identifier">make_comments</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_delete_through_belongs_to_with_dependent_destroy">
            
              <a name="method-i-test_delete_through_belongs_to_with_dependent_destroy"></a><b>test_delete_through_belongs_to_with_dependent_destroy</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_delete_through_belongs_to_with_dependent_destroy_source')" id="l_method-i-test_delete_through_belongs_to_with_dependent_destroy_source">show</a>
                
              </p>
              <div id="method-i-test_delete_through_belongs_to_with_dependent_destroy_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 241</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_delete_through_belongs_to_with_dependent_destroy</span>
  <span class="ruby-constant">Reference</span>.<span class="ruby-identifier">make_comments</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">person</span> = <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>)
  <span class="ruby-identifier">job</span>    = <span class="ruby-identifier">jobs</span>(<span class="ruby-value">:magician</span>)

  <span class="ruby-comment"># Make sure we're not deleting everything</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-number">2</span>

  <span class="ruby-identifier">assert_no_difference</span> <span class="ruby-string">'Job.count'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span> [<span class="ruby-string">'person.jobs.count'</span>, <span class="ruby-string">'Reference.count'</span>], <span class="ruby-number">-1</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">person</span>.<span class="ruby-identifier">jobs_with_dependent_destroy</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">job</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Check that the destroy callback on Reference ran</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;Reference destroyed&quot;</span>, <span class="ruby-identifier">person</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">comments</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-constant">Reference</span>.<span class="ruby-identifier">make_comments</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_delete_through_belongs_to_with_dependent_nullify">
            
              <a name="method-i-test_delete_through_belongs_to_with_dependent_nullify"></a><b>test_delete_through_belongs_to_with_dependent_nullify</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_delete_through_belongs_to_with_dependent_nullify_source')" id="l_method-i-test_delete_through_belongs_to_with_dependent_nullify_source">show</a>
                
              </p>
              <div id="method-i-test_delete_through_belongs_to_with_dependent_nullify_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 202</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_delete_through_belongs_to_with_dependent_nullify</span>
  <span class="ruby-constant">Reference</span>.<span class="ruby-identifier">make_comments</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">person</span>    = <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>)
  <span class="ruby-identifier">job</span>       = <span class="ruby-identifier">jobs</span>(<span class="ruby-value">:magician</span>)
  <span class="ruby-identifier">reference</span> = <span class="ruby-constant">Reference</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:job_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">job</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:person_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>

  <span class="ruby-identifier">assert_no_difference</span> [<span class="ruby-string">'Job.count'</span>, <span class="ruby-string">'Reference.count'</span>] <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span> <span class="ruby-string">'person.jobs.count'</span>, <span class="ruby-number">-1</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">person</span>.<span class="ruby-identifier">jobs_with_dependent_nullify</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">job</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">reference</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">job_id</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-constant">Reference</span>.<span class="ruby-identifier">make_comments</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_deleting_from_has_many_through_a_belongs_to_should_not_try_to_update_counter">
            
              <a name="method-i-test_deleting_from_has_many_through_a_belongs_to_should_not_try_to_update_counter"></a><b>test_deleting_from_has_many_through_a_belongs_to_should_not_try_to_update_counter</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_deleting_from_has_many_through_a_belongs_to_should_not_try_to_update_counter_source')" id="l_method-i-test_deleting_from_has_many_through_a_belongs_to_should_not_try_to_update_counter_source">show</a>
                
              </p>
              <div id="method-i-test_deleting_from_has_many_through_a_belongs_to_should_not_try_to_update_counter_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 769</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_deleting_from_has_many_through_a_belongs_to_should_not_try_to_update_counter</span>
  <span class="ruby-identifier">post</span>    = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>)
  <span class="ruby-identifier">address</span> = <span class="ruby-identifier">author_addresses</span>(<span class="ruby-value">:david_address</span>)

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_addresses</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">address</span>)
  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_addresses</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">address</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">post</span>[<span class="ruby-value">:author_count</span>].<span class="ruby-identifier">nil?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_destroy_all">
            
              <a name="method-i-test_destroy_all"></a><b>test_destroy_all</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_destroy_all_source')" id="l_method-i-test_destroy_all_source">show</a>
                
              </p>
              <div id="method-i-test_destroy_all_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 185</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_destroy_all</span>
  <span class="ruby-identifier">assert_no_difference</span> <span class="ruby-string">&quot;Person.count&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span> <span class="ruby-string">&quot;Reader.count&quot;</span>, <span class="ruby-number">-1</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">destroy_all</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_destroy_association">
            
              <a name="method-i-test_destroy_association"></a><b>test_destroy_association</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_destroy_association_source')" id="l_method-i-test_destroy_association_source">show</a>
                
              </p>
              <div id="method-i-test_destroy_association_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 174</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_destroy_association</span>
  <span class="ruby-identifier">assert_no_difference</span> <span class="ruby-string">&quot;Person.count&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span> <span class="ruby-string">&quot;Reader.count&quot;</span>, <span class="ruby-number">-1</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>))
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_dynamic_find_should_respect_association_include">
            
              <a name="method-i-test_dynamic_find_should_respect_association_include"></a><b>test_dynamic_find_should_respect_association_include</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_dynamic_find_should_respect_association_include_source')" id="l_method-i-test_dynamic_find_should_respect_association_include_source">show</a>
                
              </p>
              <div id="method-i-test_dynamic_find_should_respect_association_include_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 513</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_dynamic_find_should_respect_association_include</span>
  <span class="ruby-comment"># SQL error in sort clause if :include is not included</span>
  <span class="ruby-comment"># due to Unknown column 'comments.id'</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-number">1</span>).<span class="ruby-identifier">posts_with_comments_sorted_by_comment_id</span>.<span class="ruby-identifier">find_by_title</span>(<span class="ruby-string">'Welcome to the weblog'</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_explicitly_joining_join_table">
            
              <a name="method-i-test_explicitly_joining_join_table"></a><b>test_explicitly_joining_join_table</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_explicitly_joining_join_table_source')" id="l_method-i-test_explicitly_joining_join_table_source">show</a>
                
              </p>
              <div id="method-i-test_explicitly_joining_join_table_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 845</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_explicitly_joining_join_table</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">owners</span>(<span class="ruby-value">:blackbeard</span>).<span class="ruby-identifier">toys</span>, <span class="ruby-identifier">owners</span>(<span class="ruby-value">:blackbeard</span>).<span class="ruby-identifier">toys</span>.<span class="ruby-identifier">with_pet</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_find_on_has_many_association_collection_with_include_and_conditions">
            
              <a name="method-i-test_find_on_has_many_association_collection_with_include_and_conditions"></a><b>test_find_on_has_many_association_collection_with_include_and_conditions</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_find_on_has_many_association_collection_with_include_and_conditions_source')" id="l_method-i-test_find_on_has_many_association_collection_with_include_and_conditions_source">show</a>
                
              </p>
              <div id="method-i-test_find_on_has_many_association_collection_with_include_and_conditions_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 572</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_find_on_has_many_association_collection_with_include_and_conditions</span>
  <span class="ruby-identifier">post_with_no_comments</span> = <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">posts_with_no_comments</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">post_with_no_comments</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-value">:authorless</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_get_has_many_through_belongs_to_ids_with_conditions">
            
              <a name="method-i-test_get_has_many_through_belongs_to_ids_with_conditions"></a><b>test_get_has_many_through_belongs_to_ids_with_conditions</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_get_has_many_through_belongs_to_ids_with_conditions_source')" id="l_method-i-test_get_has_many_through_belongs_to_ids_with_conditions_source">show</a>
                
              </p>
              <div id="method-i-test_get_has_many_through_belongs_to_ids_with_conditions_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 738</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_get_has_many_through_belongs_to_ids_with_conditions</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">categories</span>(<span class="ruby-value">:general</span>).<span class="ruby-identifier">id</span>], <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>).<span class="ruby-identifier">categories_like_general_ids</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_get_ids">
            
              <a name="method-i-test_get_ids"></a><b>test_get_ids</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_get_ids_source')" id="l_method-i-test_get_ids_source">show</a>
                
              </p>
              <div id="method-i-test_get_ids_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 527</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_get_ids</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-value">:authorless</span>).<span class="ruby-identifier">id</span>].<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">post_ids</span>.<span class="ruby-identifier">sort</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_get_ids_for_loaded_associations">
            
              <a name="method-i-test_get_ids_for_loaded_associations"></a><b>test_get_ids_for_loaded_associations</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_get_ids_for_loaded_associations_source')" id="l_method-i-test_get_ids_for_loaded_associations_source">show</a>
                
              </p>
              <div id="method-i-test_get_ids_for_loaded_associations_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 531</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_get_ids_for_loaded_associations</span>
  <span class="ruby-identifier">person</span> = <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>)
  <span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span>(<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">0</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">person</span>.<span class="ruby-identifier">post_ids</span>
    <span class="ruby-identifier">person</span>.<span class="ruby-identifier">post_ids</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_get_ids_for_unloaded_associations_does_not_load_them">
            
              <a name="method-i-test_get_ids_for_unloaded_associations_does_not_load_them"></a><b>test_get_ids_for_unloaded_associations_does_not_load_them</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_get_ids_for_unloaded_associations_does_not_load_them_source')" id="l_method-i-test_get_ids_for_unloaded_associations_does_not_load_them_source">show</a>
                
              </p>
              <div id="method-i-test_get_ids_for_unloaded_associations_does_not_load_them_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 540</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_get_ids_for_unloaded_associations_does_not_load_them</span>
  <span class="ruby-identifier">person</span> = <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">loaded?</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-value">:authorless</span>).<span class="ruby-identifier">id</span>].<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">person</span>.<span class="ruby-identifier">post_ids</span>.<span class="ruby-identifier">sort</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">loaded?</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_association_through_a_belongs_to_association">
            
              <a name="method-i-test_has_many_association_through_a_belongs_to_association"></a><b>test_has_many_association_through_a_belongs_to_association</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_association_through_a_belongs_to_association_source')" id="l_method-i-test_has_many_association_through_a_belongs_to_association_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_association_through_a_belongs_to_association_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 559</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_association_through_a_belongs_to_association</span>
  <span class="ruby-identifier">author</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>)
  <span class="ruby-identifier">post</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:author</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">author</span>, <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;TITLE&quot;</span>, <span class="ruby-value">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;BODY&quot;</span>)
  <span class="ruby-identifier">author</span>.<span class="ruby-identifier">author_favorites</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:favorite_author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">1</span>)
  <span class="ruby-identifier">author</span>.<span class="ruby-identifier">author_favorites</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:favorite_author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">2</span>)
  <span class="ruby-identifier">author</span>.<span class="ruby-identifier">author_favorites</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:favorite_author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">3</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author</span>.<span class="ruby-identifier">author_favorites</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_favorites</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist">
            
              <a name="method-i-test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist"></a><b>test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist_source')" id="l_method-i-test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 554</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;TITLE&quot;</span>, <span class="ruby-value">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;BODY&quot;</span>)
  <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_favorites</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_association_through_a_has_many_association_to_self">
            
              <a name="method-i-test_has_many_association_through_a_has_many_association_to_self"></a><b>test_has_many_association_through_a_has_many_association_to_self</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_association_through_a_has_many_association_to_self_source')" id="l_method-i-test_has_many_association_through_a_has_many_association_to_self_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_association_through_a_has_many_association_to_self_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 589</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_association_through_a_has_many_association_to_self</span>
  <span class="ruby-identifier">sarah</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Sarah'</span>, <span class="ruby-value">:primary_contact_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">people</span>(<span class="ruby-value">:susan</span>).<span class="ruby-identifier">id</span>, <span class="ruby-value">:gender</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'F'</span>, <span class="ruby-value">:number1_fan_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">1</span>)
  <span class="ruby-identifier">john</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'John'</span>, <span class="ruby-value">:primary_contact_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sarah</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:gender</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'M'</span>, <span class="ruby-value">:number1_fan_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">1</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">sarah</span>.<span class="ruby-identifier">agents</span>, [<span class="ruby-identifier">john</span>]
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">people</span>(<span class="ruby-value">:susan</span>).<span class="ruby-identifier">agents</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:agents</span>).<span class="ruby-identifier">flatten</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:susan</span>).<span class="ruby-identifier">agents_of_agents</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys">
            
              <a name="method-i-test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys"></a><b>test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys_source')" id="l_method-i-test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 568</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">1</span>, <span class="ruby-identifier">owners</span>(<span class="ruby-value">:blackbeard</span>).<span class="ruby-identifier">toys</span>.<span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_through_belongs_to_should_update_when_the_through_foreign_key_changes">
            
              <a name="method-i-test_has_many_through_belongs_to_should_update_when_the_through_foreign_key_changes"></a><b>test_has_many_through_belongs_to_should_update_when_the_through_foreign_key_changes</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_through_belongs_to_should_update_when_the_through_foreign_key_changes_source')" id="l_method-i-test_has_many_through_belongs_to_should_update_when_the_through_foreign_key_changes_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_through_belongs_to_should_update_when_the_through_foreign_key_changes_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 747</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_through_belongs_to_should_update_when_the_through_foreign_key_changes</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:eager_other</span>)

  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_categorizations</span>
  <span class="ruby-identifier">proxy</span> = <span class="ruby-identifier">post</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:association_instance_get</span>, <span class="ruby-value">:author_categorizations</span>)

  <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">proxy</span>.<span class="ruby-identifier">stale_target?</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>).<span class="ruby-identifier">categorizations</span>.<span class="ruby-identifier">sort_by</span>(&amp;<span class="ruby-value">:id</span>), <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_categorizations</span>.<span class="ruby-identifier">sort_by</span>(&amp;<span class="ruby-value">:id</span>)

  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_id</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">id</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">proxy</span>.<span class="ruby-identifier">stale_target?</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">categorizations</span>.<span class="ruby-identifier">sort_by</span>(&amp;<span class="ruby-value">:id</span>), <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_categorizations</span>.<span class="ruby-identifier">sort_by</span>(&amp;<span class="ruby-value">:id</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_through_has_one_reflection">
            
              <a name="method-i-test_has_many_through_has_one_reflection"></a><b>test_has_many_through_has_one_reflection</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_through_has_one_reflection_source')" id="l_method-i-test_has_many_through_has_one_reflection_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_through_has_one_reflection_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 577</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_through_has_one_reflection</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">comments</span>(<span class="ruby-value">:eager_sti_on_associations_vs_comment</span>)], <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">very_special_comments</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_through_polymorphic_with_primary_key_option">
            
              <a name="method-i-test_has_many_through_polymorphic_with_primary_key_option"></a><b>test_has_many_through_polymorphic_with_primary_key_option</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_through_polymorphic_with_primary_key_option_source')" id="l_method-i-test_has_many_through_polymorphic_with_primary_key_option_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_through_polymorphic_with_primary_key_option_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 685</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_through_polymorphic_with_primary_key_option</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">categories</span>(<span class="ruby-value">:general</span>)], <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">essay_categories</span>

  <span class="ruby-identifier">authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:essay_categories</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">'categories.id'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">categories</span>(<span class="ruby-value">:general</span>).<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>), <span class="ruby-identifier">authors</span>.<span class="ruby-identifier">first</span>

  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">owners</span>(<span class="ruby-value">:blackbeard</span>)], <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">essay_owners</span>

  <span class="ruby-identifier">authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:essay_owners</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;owners.name = 'blackbeard'&quot;</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>), <span class="ruby-identifier">authors</span>.<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_through_with_default_scope_on_join_model">
            
              <a name="method-i-test_has_many_through_with_default_scope_on_join_model"></a><b>test_has_many_through_with_default_scope_on_join_model</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_through_with_default_scope_on_join_model_source')" id="l_method-i-test_has_many_through_with_default_scope_on_join_model_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_through_with_default_scope_on_join_model_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 711</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_through_with_default_scope_on_join_model</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">all</span>, <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">comments_on_first_posts</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_through_with_polymorphic_source">
            
              <a name="method-i-test_has_many_through_with_polymorphic_source"></a><b>test_has_many_through_with_polymorphic_source</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_through_with_polymorphic_source_source')" id="l_method-i-test_has_many_through_with_polymorphic_source_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_through_with_polymorphic_source_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 849</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_through_with_polymorphic_source</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-identifier">tags</span>(<span class="ruby-value">:general</span>).<span class="ruby-identifier">tagged_posts</span>.<span class="ruby-identifier">create!</span> <span class="ruby-value">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;foo&quot;</span>, <span class="ruby-value">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;bar&quot;</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">tags</span>(<span class="ruby-value">:general</span>)], <span class="ruby-identifier">post</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">tags</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_has_many_through_with_primary_key_option">
            
              <a name="method-i-test_has_many_through_with_primary_key_option"></a><b>test_has_many_through_with_primary_key_option</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_has_many_through_with_primary_key_option_source')" id="l_method-i-test_has_many_through_with_primary_key_option_source">show</a>
                
              </p>
              <div id="method-i-test_has_many_through_with_primary_key_option_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 697</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_has_many_through_with_primary_key_option</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">categories</span>(<span class="ruby-value">:general</span>)], <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">essay_categories_2</span>

  <span class="ruby-identifier">authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:essay_categories_2</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">'categories.id'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">categories</span>(<span class="ruby-value">:general</span>).<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>), <span class="ruby-identifier">authors</span>.<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_include-3F">
            
              <a name="method-i-test_include-3F"></a><b>test_include?</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_include-3F_source')" id="l_method-i-test_include-3F_source">show</a>
                
              </p>
              <div id="method-i-test_include-3F_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 39</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_include?</span>
  <span class="ruby-identifier">person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">post</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">post</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_build">
            
              <a name="method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_build"></a><b>test_include_method_in_association_through_should_return_true_for_instance_added_with_build</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_build_source')" id="l_method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_build_source">show</a>
                
              </p>
              <div id="method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_build_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 671</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_include_method_in_association_through_should_return_true_for_instance_added_with_build</span>
  <span class="ruby-identifier">person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">reference</span> = <span class="ruby-identifier">person</span>.<span class="ruby-identifier">references</span>.<span class="ruby-identifier">build</span>
  <span class="ruby-identifier">job</span> = <span class="ruby-identifier">reference</span>.<span class="ruby-identifier">build_job</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">job</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_nested_builds">
            
              <a name="method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_nested_builds"></a><b>test_include_method_in_association_through_should_return_true_for_instance_added_with_nested_builds</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_nested_builds_source')" id="l_method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_nested_builds_source">show</a>
                
              </p>
              <div id="method-i-test_include_method_in_association_through_should_return_true_for_instance_added_with_nested_builds_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 678</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_include_method_in_association_through_should_return_true_for_instance_added_with_nested_builds</span>
  <span class="ruby-identifier">author</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-identifier">author</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">build</span>
  <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">post</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">build</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">author</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">comment</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_inner_join_with_quoted_table_name">
            
              <a name="method-i-test_inner_join_with_quoted_table_name"></a><b>test_inner_join_with_quoted_table_name</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_inner_join_with_quoted_table_name_source')" id="l_method-i-test_inner_join_with_quoted_table_name_source">show</a>
                
              </p>
              <div id="method-i-test_inner_join_with_quoted_table_name_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 523</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_inner_join_with_quoted_table_name</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">2</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_interpolated_conditions">
            
              <a name="method-i-test_interpolated_conditions"></a><b>test_interpolated_conditions</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_interpolated_conditions_source')" id="l_method-i-test_interpolated_conditions_source">show</a>
                
              </p>
              <div id="method-i-test_interpolated_conditions_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 778</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_interpolated_conditions</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>)
  <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">post</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">tags</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">interpolated_tags</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">tags</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">interpolated_tags_2</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_joining_has_many_through_belongs_to">
            
              <a name="method-i-test_joining_has_many_through_belongs_to"></a><b>test_joining_has_many_through_belongs_to</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_joining_has_many_through_belongs_to_source')" id="l_method-i-test_joining_has_many_through_belongs_to_source">show</a>
                
              </p>
              <div id="method-i-test_joining_has_many_through_belongs_to_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 726</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_joining_has_many_through_belongs_to</span>
  <span class="ruby-identifier">posts</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:author_categorizations</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">'posts.id'</span>).
               <span class="ruby-identifier">where</span>(<span class="ruby-string">'categorizations.id'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">categorizations</span>(<span class="ruby-value">:mary_thinking_sti</span>).<span class="ruby-identifier">id</span>)

  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">posts</span>(<span class="ruby-value">:eager_other</span>), <span class="ruby-identifier">posts</span>(<span class="ruby-value">:misc_by_mary</span>), <span class="ruby-identifier">posts</span>(<span class="ruby-value">:other_by_mary</span>)], <span class="ruby-identifier">posts</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_joining_has_many_through_with_uniq">
            
              <a name="method-i-test_joining_has_many_through_with_uniq"></a><b>test_joining_has_many_through_with_uniq</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_joining_has_many_through_with_uniq_source')" id="l_method-i-test_joining_has_many_through_with_uniq_source">show</a>
                
              </p>
              <div id="method-i-test_joining_has_many_through_with_uniq_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 720</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_joining_has_many_through_with_uniq</span>
  <span class="ruby-identifier">mary</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:unique_categorized_posts</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">authors</span>(<span class="ruby-value">:mary</span>).<span class="ruby-identifier">id</span>).<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">1</span>, <span class="ruby-identifier">mary</span>.<span class="ruby-identifier">unique_categorized_posts</span>.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-number">1</span>, <span class="ruby-identifier">mary</span>.<span class="ruby-identifier">unique_categorized_post_ids</span>.<span class="ruby-identifier">length</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_modifying_has_many_through_has_one_reflection_should_raise">
            
              <a name="method-i-test_modifying_has_many_through_has_one_reflection_should_raise"></a><b>test_modifying_has_many_through_has_one_reflection_should_raise</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_modifying_has_many_through_has_one_reflection_should_raise_source')" id="l_method-i-test_modifying_has_many_through_has_one_reflection_should_raise_source">show</a>
                
              </p>
              <div id="method-i-test_modifying_has_many_through_has_one_reflection_should_raise_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 581</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_modifying_has_many_through_has_one_reflection_should_raise</span>
  [
    <span class="ruby-identifier">lambda</span> { <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">very_special_comments</span> = [<span class="ruby-constant">VerySpecialComment</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Gorp!&quot;</span>, <span class="ruby-value">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">1011</span>), <span class="ruby-constant">VerySpecialComment</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Eep!&quot;</span>, <span class="ruby-value">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">1012</span>)] },
    <span class="ruby-identifier">lambda</span> { <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">very_special_comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">VerySpecialComment</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Hoohah!&quot;</span>, <span class="ruby-value">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-number">1013</span>) },
    <span class="ruby-identifier">lambda</span> { <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">very_special_comments</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">very_special_comments</span>.<span class="ruby-identifier">first</span>) },
  ].<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">HasManyThroughCantAssociateThroughHasOneOrManyReflection</span>, &amp;<span class="ruby-identifier">block</span>) }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_preloading_empty_through_association_via_joins">
            
              <a name="method-i-test_preloading_empty_through_association_via_joins"></a><b>test_preloading_empty_through_association_via_joins</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_preloading_empty_through_association_via_joins_source')" id="l_method-i-test_preloading_empty_through_association_via_joins_source">show</a>
                
              </p>
              <div id="method-i-test_preloading_empty_through_association_via_joins_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 837</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_preloading_empty_through_association_via_joins</span>
  <span class="ruby-identifier">person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Gaga&quot;</span>)
  <span class="ruby-identifier">person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>).<span class="ruby-identifier">where</span>(<span class="ruby-string">'readers.id = 1 or 1=1'</span>).<span class="ruby-identifier">includes</span>(<span class="ruby-value">:posts</span>).<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">first</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">loaded?</span>, <span class="ruby-string">'person.posts should be loaded'</span>
  <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_primary_key_option_on_source">
            
              <a name="method-i-test_primary_key_option_on_source"></a><b>test_primary_key_option_on_source</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_primary_key_option_on_source_source')" id="l_method-i-test_primary_key_option_on_source_source">show</a>
                
              </p>
              <div id="method-i-test_primary_key_option_on_source_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 785</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_primary_key_option_on_source</span>
  <span class="ruby-identifier">post</span>     = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>)
  <span class="ruby-identifier">category</span> = <span class="ruby-identifier">categories</span>(<span class="ruby-value">:general</span>)
  <span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value">:named_category_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">category</span>.<span class="ruby-identifier">name</span>)

  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">category</span>], <span class="ruby-identifier">post</span>.<span class="ruby-identifier">named_categories</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">category</span>.<span class="ruby-identifier">name</span>], <span class="ruby-identifier">post</span>.<span class="ruby-identifier">named_category_ids</span> <span class="ruby-comment"># checks when target loaded</span>
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">category</span>.<span class="ruby-identifier">name</span>], <span class="ruby-identifier">post</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">named_category_ids</span> <span class="ruby-comment"># checks when target no loaded</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_push_with_invalid_join_record">
            
              <a name="method-i-test_push_with_invalid_join_record"></a><b>test_push_with_invalid_join_record</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_push_with_invalid_join_record_source')" id="l_method-i-test_push_with_invalid_join_record_source">show</a>
                
              </p>
              <div id="method-i-test_push_with_invalid_join_record_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 440</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_push_with_invalid_join_record</span>
  <span class="ruby-identifier">repair_validations</span>(<span class="ruby-constant">Contract</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Contract</span>.<span class="ruby-identifier">validate</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>[<span class="ruby-value">:base</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'Invalid Contract'</span> }

    <span class="ruby-identifier">firm</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-value">:first_firm</span>)
    <span class="ruby-identifier">lifo</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'lifo'</span>)
    <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>) { <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">developers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">lifo</span> }

    <span class="ruby-identifier">lifo</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'lifo'</span>)
    <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>) { <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">developers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">lifo</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_push_with_invalid_record">
            
              <a name="method-i-test_push_with_invalid_record"></a><b>test_push_with_invalid_record</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_push_with_invalid_record_source')" id="l_method-i-test_push_with_invalid_record_source">show</a>
                
              </p>
              <div id="method-i-test_push_with_invalid_record_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 435</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_push_with_invalid_record</span>
  <span class="ruby-identifier">firm</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-value">:first_firm</span>)
  <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>) { <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">developers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'0'</span>) }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_replace_association">
            
              <a name="method-i-test_replace_association"></a><b>test_replace_association</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_replace_association_source')" id="l_method-i-test_replace_association_source">show</a>
                
              </p>
              <div id="method-i-test_replace_association_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 333</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_replace_association</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">4</span>){<span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>);<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>);<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>); <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>)}

  <span class="ruby-comment"># 1 query to delete the existing reader (michael)</span>
  <span class="ruby-comment"># 1 query to associate the new reader (david)</span>
  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">2</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>)]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_queries</span>(<span class="ruby-number">0</span>){
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>))
    <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>))
  }

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>))
  <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>))
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_replace_by_id_order_is_preserved">
            
              <a name="method-i-test_replace_by_id_order_is_preserved"></a><b>test_replace_by_id_order_is_preserved</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_replace_by_id_order_is_preserved_source')" id="l_method-i-test_replace_by_id_order_is_preserved_source">show</a>
                
              </p>
              <div id="method-i-test_replace_by_id_order_is_preserved_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 362</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_replace_by_id_order_is_preserved</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">person_ids</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">id</span>]
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">id</span>], <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:person_id</span>)

  <span class="ruby-comment"># Test the inverse order in case the first success was a coincidence</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">person_ids</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">id</span>]
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">id</span>], <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:person_id</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_replace_order_is_preserved">
            
              <a name="method-i-test_replace_order_is_preserved"></a><b>test_replace_order_is_preserved</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_replace_order_is_preserved_source')" id="l_method-i-test_replace_order_is_preserved_source">show</a>
                
              </p>
              <div id="method-i-test_replace_order_is_preserved_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 351</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_replace_order_is_preserved</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>), <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>)]
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">id</span>], <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:person_id</span>)

  <span class="ruby-comment"># Test the inverse order in case the first success was a coincidence</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>), <span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>)]
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-value">:david</span>).<span class="ruby-identifier">id</span>], <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">order</span>(<span class="ruby-string">'id'</span>).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:person_id</span>)
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_save_bang_should_raise_exception_when_join_record_has_errors">
            
              <a name="method-i-test_save_bang_should_raise_exception_when_join_record_has_errors"></a><b>test_save_bang_should_raise_exception_when_join_record_has_errors</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_save_bang_should_raise_exception_when_join_record_has_errors_source')" id="l_method-i-test_save_bang_should_raise_exception_when_join_record_has_errors_source">show</a>
                
              </p>
              <div id="method-i-test_save_bang_should_raise_exception_when_join_record_has_errors_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 819</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_save_bang_should_raise_exception_when_join_record_has_errors</span>
  <span class="ruby-identifier">repair_validations</span>(<span class="ruby-constant">Categorization</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">validate</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>[<span class="ruby-value">:base</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'Invalid Categorization'</span> }
    <span class="ruby-identifier">c</span> = <span class="ruby-constant">Category</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Fishing'</span>, <span class="ruby-value">:authors</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-constant">Author</span>.<span class="ruby-identifier">first</span>])
    <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save!</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_save_should_not_raise_exception_when_join_record_has_errors">
            
              <a name="method-i-test_save_should_not_raise_exception_when_join_record_has_errors"></a><b>test_save_should_not_raise_exception_when_join_record_has_errors</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_save_should_not_raise_exception_when_join_record_has_errors_source')" id="l_method-i-test_save_should_not_raise_exception_when_join_record_has_errors_source">show</a>
                
              </p>
              <div id="method-i-test_save_should_not_raise_exception_when_join_record_has_errors_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 802</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_save_should_not_raise_exception_when_join_record_has_errors</span>
  <span class="ruby-identifier">repair_validations</span>(<span class="ruby-constant">Categorization</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-constant">Categorization</span>.<span class="ruby-identifier">validate</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">errors</span>[<span class="ruby-value">:base</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'Invalid Categorization'</span> }
    <span class="ruby-identifier">c</span> = <span class="ruby-constant">Category</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'Fishing'</span>, <span class="ruby-value">:authors</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-constant">Author</span>.<span class="ruby-identifier">first</span>])
    <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_select_chosen_fields_only">
            
              <a name="method-i-test_select_chosen_fields_only"></a><b>test_select_chosen_fields_only</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_select_chosen_fields_only_source')" id="l_method-i-test_select_chosen_fields_only_source">show</a>
                
              </p>
              <div id="method-i-test_select_chosen_fields_only_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 733</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_select_chosen_fields_only</span>
  <span class="ruby-identifier">author</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-value">:david</span>)
  <span class="ruby-identifier">assert_equal</span> [<span class="ruby-string">'body'</span>], <span class="ruby-identifier">author</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">select</span>(<span class="ruby-string">'comments.body'</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">keys</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_should_raise_exception_for_destroying_mismatching_records">
            
              <a name="method-i-test_should_raise_exception_for_destroying_mismatching_records"></a><b>test_should_raise_exception_for_destroying_mismatching_records</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_should_raise_exception_for_destroying_mismatching_records_source')" id="l_method-i-test_should_raise_exception_for_destroying_mismatching_records_source">show</a>
                
              </p>
              <div id="method-i-test_should_raise_exception_for_destroying_mismatching_records_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 196</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_should_raise_exception_for_destroying_mismatching_records</span>
  <span class="ruby-identifier">assert_no_difference</span> [<span class="ruby-string">&quot;Person.count&quot;</span>, <span class="ruby-string">&quot;Reader.count&quot;</span>] <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">AssociationTypeMismatch</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>)) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_size_of_through_association_should_increase_correctly_when_has_many_association_is_added">
            
              <a name="method-i-test_size_of_through_association_should_increase_correctly_when_has_many_association_is_added"></a><b>test_size_of_through_association_should_increase_correctly_when_has_many_association_is_added</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_size_of_through_association_should_increase_correctly_when_has_many_association_is_added_source')" id="l_method-i-test_size_of_through_association_should_increase_correctly_when_has_many_association_is_added_source">show</a>
                
              </p>
              <div id="method-i-test_size_of_through_association_should_increase_correctly_when_has_many_association_is_added_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 704</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_size_of_through_association_should_increase_correctly_when_has_many_association_is_added</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:thinking</span>)
  <span class="ruby-identifier">readers</span> = <span class="ruby-identifier">post</span>.<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">size</span>
  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">people</span>(<span class="ruby-value">:michael</span>)
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">readers</span> <span class="ruby-operator">+</span> <span class="ruby-number">1</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">size</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_update_counter_caches_on_delete">
            
              <a name="method-i-test_update_counter_caches_on_delete"></a><b>test_update_counter_caches_on_delete</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_update_counter_caches_on_delete_source')" id="l_method-i-test_update_counter_caches_on_delete_source">show</a>
                
              </p>
              <div id="method-i-test_update_counter_caches_on_delete_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 302</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_update_counter_caches_on_delete</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>)
  <span class="ruby-identifier">tag</span>  = <span class="ruby-identifier">post</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'doomed'</span>)

  <span class="ruby-identifier">assert_difference</span> [<span class="ruby-string">'post.reload.taggings_count'</span>, <span class="ruby-string">'post.reload.tags_count'</span>], <span class="ruby-number">-1</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">tag</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_update_counter_caches_on_delete_with_dependent_destroy">
            
              <a name="method-i-test_update_counter_caches_on_delete_with_dependent_destroy"></a><b>test_update_counter_caches_on_delete_with_dependent_destroy</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_update_counter_caches_on_delete_with_dependent_destroy_source')" id="l_method-i-test_update_counter_caches_on_delete_with_dependent_destroy_source">show</a>
                
              </p>
              <div id="method-i-test_update_counter_caches_on_delete_with_dependent_destroy_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 311</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_update_counter_caches_on_delete_with_dependent_destroy</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>)
  <span class="ruby-identifier">tag</span>  = <span class="ruby-identifier">post</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'doomed'</span>)
  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">update_column</span>(<span class="ruby-value">:tags_with_destroy_count</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">count</span>)

  <span class="ruby-identifier">assert_difference</span> [<span class="ruby-string">'post.reload.taggings_count'</span>, <span class="ruby-string">'post.reload.tags_with_destroy_count'</span>], <span class="ruby-number">-1</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">tags_with_destroy</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">tag</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-test_update_counter_caches_on_delete_with_dependent_nullify">
            
              <a name="method-i-test_update_counter_caches_on_delete_with_dependent_nullify"></a><b>test_update_counter_caches_on_delete_with_dependent_nullify</b>()
            
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-test_update_counter_caches_on_delete_with_dependent_nullify_source')" id="l_method-i-test_update_counter_caches_on_delete_with_dependent_nullify_source">show</a>
                
              </p>
              <div id="method-i-test_update_counter_caches_on_delete_with_dependent_nullify_source" class="dyn-source">
                <pre><span class="ruby-comment"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 321</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">test_update_counter_caches_on_delete_with_dependent_nullify</span>
  <span class="ruby-identifier">post</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>)
  <span class="ruby-identifier">tag</span>  = <span class="ruby-identifier">post</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-value">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">'doomed'</span>)
  <span class="ruby-identifier">post</span>.<span class="ruby-identifier">update_column</span>(<span class="ruby-value">:tags_with_nullify_count</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">count</span>)

  <span class="ruby-identifier">assert_no_difference</span> <span class="ruby-string">'post.reload.taggings_count'</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span> <span class="ruby-string">'post.reload.tags_with_nullify_count'</span>, <span class="ruby-number">-1</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">posts</span>(<span class="ruby-value">:welcome</span>).<span class="ruby-identifier">tags_with_nullify</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">tag</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>
    </div>
  </body>
</html>    